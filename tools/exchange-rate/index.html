<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>환율 계산기 · 해외결제 수수료 포함 현실가 | Yuchani Tools pro</title>
  <meta name="description" content="해외 결제 금액에 카드사·브랜드 수수료를 반영해 실제 청구될 금액과 적용 환율을 계산하세요. 실시간 환율 불러오기, 수수료 시나리오 비교, DCC(원화결제) 손익 분석까지 한 번에 지원합니다.">
  <link rel="canonical" href="https://tools.yuchani.com/tools/exchange-rate/">
  <meta name="robots" content="index,follow">
  <meta property="og:type" content="website">
  <meta property="og:title" content="환율 계산기 · 해외결제 현실가 추정">
  <meta property="og:description" content="카드사·브랜드 수수료를 더한 실제 청구 예상 금액을 계산하고 원화결제(DCC)와 비교하세요.">
  <meta property="og:url" content="https://tools.yuchani.com/tools/exchange-rate/">
  <meta property="og:image" content="https://tools.yuchani.com/assets/og/cover.png">
  <meta name="twitter:card" content="summary_large_image">

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    :root { color-scheme: dark; }
    body { background:#0F1113; }
    .ring-soft { box-shadow: inset 0 0 0 1px rgba(255,255,255,.08); }
    .panel { background:#11141A; }
    .glass { background:linear-gradient(160deg,rgba(148,163,184,.08),rgba(148,163,184,.02)); backdrop-filter: blur(18px); }
  </style>

  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebApplication",
    "name":"환율 계산기",
    "url":"https://tools.yuchani.com/tools/exchange-rate/",
    "applicationCategory":"FinanceApplication",
    "operatingSystem":"Web",
    "description":"해외 결제 금액에서 카드사·브랜드 수수료를 더해 실제 청구 금액과 적용 환율을 계산하는 웹 계산기",
    "featureList":[
      "실시간 환율 불러오기",
      "카드사·브랜드 수수료 반영",
      "DCC(원화결제) 비교 분석",
      "효과적인 적용 환율 계산"
    ]
  }
  </script>

  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"FAQPage",
    "mainEntity":[
      {
        "@type":"Question",
        "name":"실시간 환율은 어디에서 가져오나요?",
        "acceptedAnswer":{"@type":"Answer","text":"'실시간 환율 불러오기' 버튼을 누르면 공개 API(Open Exchange Rate API 계열)를 호출하여 최신 레퍼런스 환율을 가져옵니다. 네트워크 환경에 따라 실패할 수 있으며, 직접 입력한 환율을 그대로 사용할 수도 있습니다."}
      },
      {
        "@type":"Question",
        "name":"카드사 수수료는 어떻게 반영되나요?",
        "acceptedAnswer":{"@type":"Answer","text":"카드사/브랜드 수수료 입력란에 % 단위로 입력하면, 기준 환율 금액에 해당 비율을 곱해 실제 청구 금액과 적용 환율을 계산합니다."}
      },
      {
        "@type":"Question",
        "name":"원화결제(DCC)와의 비교는 어떻게 이뤄지나요?",
        "acceptedAnswer":{"@type":"Answer","text":"원화결제 시 제시받은 환율을 '원화결제 환율(DCC)' 입력란에 넣으면, 동일 금액에 대해 국내 원화 청구 예상액과 비교하여 절감 또는 추가 부담 금액을 계산합니다."}
      },
      {
        "@type":"Question",
        "name":"환율 단위를 다르게 입력해도 되나요?",
        "acceptedAnswer":{"@type":"Answer","text":"기준 환율은 '1 결제 통화 = ? 정산 통화' 형태로 입력합니다. 예를 들어 1 USD가 1320 KRW라면 1320을 입력하면 됩니다."}
      }
    ]
  }
  </script>
</head>
<body class="text-white">
  <div data-include="/partials/header.html"></div>

  <main class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
      <div>
        <p class="text-xs uppercase tracking-[0.4em] text-emerald-300/80">Exchange Intelligence</p>
        <h1 class="mt-2 text-2xl md:text-3xl font-bold tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-emerald-300 via-cyan-300 to-blue-400">환율 계산기 · 해외결제 현실가</h1>
        <p class="mt-2 text-white/70 max-w-2xl">카드사·브랜드 수수료를 모두 반영한 실제 청구 예상액과 적용 환율을 계산하세요. 실시간 환율을 불러오고, 원화결제(DCC) 대비 손익까지 한 화면에서 확인할 수 있습니다.</p>
      </div>
      <div class="flex flex-wrap gap-2">
        <a href="/" class="inline-flex items-center gap-2 px-3 py-1.5 text-sm rounded-xl border border-emerald-500/35 bg-emerald-500/15 text-emerald-100 hover:bg-emerald-500/25">
          <i data-lucide="home" class="w-4 h-4"></i> 메인으로
        </a>
        <button id="btnReset" class="inline-flex items-center gap-2 px-3 py-1.5 text-sm rounded-xl border border-white/15 hover:bg-white/10">
          <i data-lucide="rotate-ccw" class="w-4 h-4"></i> 초기화
        </button>
      </div>
    </div>

    <section class="mt-6 grid gap-5 lg:grid-cols-[minmax(0,1.75fr)_minmax(0,1.25fr)]">
      <div class="rounded-2xl border border-white/10 ring-soft panel p-5 space-y-5">
        <div class="flex items-center justify-between gap-3">
          <div>
            <h2 class="text-lg font-semibold flex items-center gap-2"><i data-lucide="credit-card" class="w-5 h-5 text-cyan-300"></i> 결제 조건 입력</h2>
            <p class="text-sm text-white/60">금액, 통화, 환율, 수수료를 입력하면 실시간으로 계산됩니다.</p>
          </div>
          <button id="btnFetchRate" class="inline-flex items-center gap-2 px-3 py-1.5 text-sm rounded-xl border border-cyan-400/35 bg-cyan-400/10 text-cyan-100 hover:bg-cyan-400/20">
            <i data-lucide="radar" class="w-4 h-4"></i> 실시간 환율 불러오기
          </button>
        </div>

        <div class="grid gap-4 md:grid-cols-2">
          <label class="flex flex-col gap-1">
            <span class="text-sm text-white/70">해외 결제 금액</span>
            <div class="relative flex items-center">
              <input id="amount" type="number" inputmode="decimal" step="0.01" value="120" min="0" class="w-full rounded-xl border border-white/10 bg-black/40 px-3 py-2.5 text-sm outline-none focus:ring-2 focus:ring-emerald-400/50" placeholder="예: 120.50">
              <span id="amountCurrencyLabel" class="absolute right-3 text-xs text-white/40">USD</span>
            </div>
          </label>
          <label class="flex flex-col gap-1">
            <span class="text-sm text-white/70">결제 통화</span>
            <select id="baseCurrency" class="w-full rounded-xl border border-white/10 bg-black/40 px-3 py-2.5 text-sm outline-none focus:ring-2 focus:ring-emerald-400/50"></select>
          </label>
          <label class="flex flex-col gap-1">
            <span class="text-sm text-white/70">정산 통화</span>
            <select id="targetCurrency" class="w-full rounded-xl border border-white/10 bg-black/40 px-3 py-2.5 text-sm outline-none focus:ring-2 focus:ring-emerald-400/50"></select>
          </label>
          <label class="flex flex-col gap-1">
            <span class="text-sm text-white/70">기준 환율 (1 결제 통화 → 정산 통화)</span>
            <input id="rate" type="number" inputmode="decimal" step="0.0001" value="1320" min="0" class="w-full rounded-xl border border-white/10 bg-black/40 px-3 py-2.5 text-sm outline-none focus:ring-2 focus:ring-emerald-400/50" placeholder="예: 1320.50">
          </label>
        </div>

        <div class="grid gap-4 md:grid-cols-3">
          <label class="flex flex-col gap-1">
            <span class="text-sm text-white/70">카드사 수수료 (%)</span>
            <input id="cardFee" type="number" inputmode="decimal" step="0.01" value="1.0" min="0" class="w-full rounded-xl border border-white/10 bg-black/40 px-3 py-2.5 text-sm outline-none focus:ring-2 focus:ring-emerald-400/50">
          </label>
          <label class="flex flex-col gap-1">
            <span class="text-sm text-white/70">브랜드 수수료 (VISA/Master 등, %)</span>
            <input id="networkFee" type="number" inputmode="decimal" step="0.01" value="0.8" min="0" class="w-full rounded-xl border border-white/10 bg-black/40 px-3 py-2.5 text-sm outline-none focus:ring-2 focus:ring-emerald-400/50">
          </label>
          <label class="flex flex-col gap-1">
            <span class="text-sm text-white/70">정액 수수료 (정산 통화)</span>
            <input id="flatFee" type="number" inputmode="decimal" step="0.01" value="0" min="0" class="w-full rounded-xl border border-white/10 bg-black/40 px-3 py-2.5 text-sm outline-none focus:ring-2 focus:ring-emerald-400/50" placeholder="예: 1200">
          </label>
        </div>

        <div class="grid gap-4 md:grid-cols-2">
          <label class="flex flex-col gap-1">
            <span class="text-sm text-white/70">원화결제 환율 (DCC, 선택)</span>
            <input id="dccRate" type="number" inputmode="decimal" step="0.0001" placeholder="예: 1450" class="w-full rounded-xl border border-white/10 bg-black/40 px-3 py-2.5 text-sm outline-none focus:ring-2 focus:ring-emerald-400/50">
          </label>
          <label class="flex flex-col gap-1">
            <span class="text-sm text-white/70">메모 / 시나리오 태그 (선택)</span>
            <input id="scenarioLabel" type="text" maxlength="32" placeholder="예: 해외직구 세일기간" class="w-full rounded-xl border border-white/10 bg-black/40 px-3 py-2.5 text-sm outline-none focus:ring-2 focus:ring-emerald-400/50">
          </label>
        </div>

        <p id="rateStatus" class="text-xs text-white/45">Tip: 환율은 1 결제 통화당 정산 통화 금액을 입력합니다. (예: 1 USD = 1320 KRW)</p>
      </div>

      <div class="rounded-2xl border border-white/10 ring-soft glass p-5 flex flex-col gap-4">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-xs uppercase tracking-[0.35em] text-white/50">Summary</p>
            <h2 class="mt-1 text-xl font-semibold">실제 청구 예상</h2>
          </div>
          <div class="text-right text-sm text-white/50" id="scenarioDisplay">시나리오: 기본</div>
        </div>

        <div class="grid gap-3">
          <div class="rounded-2xl border border-emerald-400/30 bg-emerald-400/10 p-4">
            <div class="text-xs text-emerald-200/80">예상 청구액</div>
            <div id="finalAmount" class="mt-1 text-2xl font-semibold text-emerald-100">₩0</div>
            <div id="effectiveRate" class="text-xs text-emerald-200/80">적용 환율: -</div>
          </div>

          <div class="rounded-2xl border border-white/10 bg-black/30 p-4 grid gap-2 text-sm">
            <div class="flex items-center justify-between"><span class="text-white/60">기준 환율 금액</span><span id="baseConverted" class="font-medium">-</span></div>
            <div class="flex items-center justify-between"><span class="text-white/60">비율 수수료 합계</span><span id="percentFees" class="font-medium">-</span></div>
            <div class="flex items-center justify-between"><span class="text-white/60">정액 수수료</span><span id="flatFeeAmount" class="font-medium">-</span></div>
            <div class="flex items-center justify-between text-white/70 border-t border-white/10 pt-2"><span>총 마크업 비율</span><span id="markupPercent" class="font-semibold">-</span></div>
          </div>
        </div>

        <div class="rounded-2xl border border-white/10 bg-black/20 p-4 text-sm space-y-2">
          <div class="flex items-center gap-2 text-white/70">
            <i data-lucide="activity" class="w-4 h-4 text-cyan-300"></i>
            <span>원화결제(DCC) 비교</span>
          </div>
          <div id="dccSummary" class="text-white/60 leading-relaxed">DCC 환율을 입력하면 비교 결과가 표시됩니다.</div>
        </div>
      </div>
    </section>

    <section class="mt-8 grid gap-4 md:grid-cols-3">
      <div class="rounded-2xl border border-white/10 ring-soft panel p-4 space-y-2">
        <div class="flex items-center gap-2 text-sm text-white/75">
          <i data-lucide="gauge" class="w-4 h-4 text-sky-300"></i>
          <span>적용 환율 트래커</span>
        </div>
        <p id="deltaInfo" class="text-xs text-white/55 leading-relaxed">실제 적용 환율은 입력한 기준 환율과 동일하게 시작합니다.</p>
      </div>
      <div class="rounded-2xl border border-white/10 ring-soft panel p-4 space-y-2">
        <div class="flex items-center gap-2 text-sm text-white/75">
          <i data-lucide="sparkles" class="w-4 h-4 text-amber-300"></i>
          <span>수수료 분리 보기</span>
        </div>
        <p class="text-xs text-white/55 leading-relaxed">카드사와 브랜드 수수료를 각각 입력하면 총 마크업에 어떻게 기여하는지 확인할 수 있습니다. 숫자를 조정하며 가장 합리적인 조합을 찾으세요.</p>
      </div>
      <div class="rounded-2xl border border-white/10 ring-soft panel p-4 space-y-2">
        <div class="flex items-center gap-2 text-sm text-white/75">
          <i data-lucide="database" class="w-4 h-4 text-emerald-300"></i>
          <span>시나리오 저장 Tip</span>
        </div>
        <p class="text-xs text-white/55 leading-relaxed">시나리오 태그를 입력해 계산 결과를 스크린샷 또는 메모 앱으로 기록하면 다음 여행 계획 시 유용하게 참고할 수 있습니다.</p>
      </div>
    </section>

    <section class="mt-8 grid gap-5 md:grid-cols-2">
      <div class="rounded-2xl border border-white/10 ring-soft panel p-5">
        <div class="flex items-center gap-2 text-sm text-white/80">
          <i data-lucide="lightbulb" class="w-4 h-4 text-yellow-300"></i>
          <div class="font-semibold">도움말 & 팁</div>
        </div>
        <ul class="mt-3 list-disc pl-5 text-sm text-white/70 space-y-1.5">
          <li>환율은 여행 전후로 크게 달라질 수 있으니, <strong>실시간 환율</strong> 버튼으로 최신 값을 확인하세요.</li>
          <li>카드사/브랜드 수수료는 약관에 따라 0.5%~1.5% 내외로 다르며, 각 항목을 <strong>별도 입력</strong>해야 실제와 가까운 값이 나옵니다.</li>
          <li>정액 수수료가 있는 경우(예: 일부 핀테크·체크카드)는 <strong>정산 통화</strong> 기준으로 입력하세요.</li>
          <li>DCC 환율이 실제 환율보다 높다면 <strong>거절</strong>하고 현지 통화로 결제하는 것이 유리할 수 있습니다.</li>
          <li>결제 확정 환율은 통상 1~2영업일 후 확정되므로, 은행 고시환율과 소폭 차이가 발생할 수 있습니다.</li>
        </ul>
      </div>
      <div class="rounded-2xl border border-white/10 ring-soft panel p-5">
        <div class="flex items-center gap-2 text-sm text-white/80">
          <i data-lucide="help-circle" class="w-4 h-4 text-cyan-300"></i>
          <div class="font-semibold">사용설명서 & FAQ</div>
        </div>
        <ol class="mt-3 list-decimal pl-5 text-sm text-white/70 space-y-1.5">
          <li><strong>결제 금액·통화</strong>를 입력하고 기준 환율을 확인합니다.</li>
          <li><strong>카드사·브랜드 수수료</strong>를 퍼센트 단위로 입력합니다.</li>
          <li>필요 시 <strong>정액 수수료</strong>나 DCC 환율을 추가합니다.</li>
          <li><strong>실시간 환율 불러오기</strong>를 눌러 최신 환율을 적용하거나 직접 입력한 환율을 사용합니다.</li>
          <li>결과 카드에서 청구 예상 금액, 적용 환율, DCC 대비 차이를 확인합니다.</li>
        </ol>
      </div>
    </section>
  </main>

  <div data-include="/partials/footer.html"></div>

  <script defer src="/inject-layout.js?v=6"></script>
  <script>
  (function(){
    if (window.__ytIncludeFallbackLoaded) return;
    window.__ytIncludeFallbackLoaded = true;
    async function loadPartials(){
      const nodes = document.querySelectorAll('[data-include]');
      for (const el of nodes){
        const raw = el.getAttribute('data-include') || '';
        let url = raw;
        try { url = raw.startsWith('/') ? raw : new URL(raw, location.href).pathname; } catch(e) {}
        try {
          const res = await fetch(url, { credentials: 'same-origin', cache: 'no-cache' });
          if (!res.ok) throw new Error('HTTP '+res.status);
          const html = await res.text();
          el.innerHTML = html;
        } catch (err) {
          console.warn('[include:fallback] 실패', url, err);
          el.innerHTML = '<div style="padding:.75rem;border:1px solid #e5e7eb33;border-radius:.5rem;color:#fca5a5">include 실패: <code>'+url+'</code><br><small>'+String(err)+'</small></div>';
        }
      }
      const anyIncluded = Array.from(document.querySelectorAll('[data-include]')).some(n => n.children.length>0);
      console.assert(anyIncluded || Array.from(document.querySelectorAll('[data-include]')).length===0, 'include 결과가 비어 있습니다. 경로/서버 응답을 확인하세요.');
    }
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', loadPartials, { once:true });
    } else {
      loadPartials();
    }
  })();
  </script>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    window.lucide?.createIcons?.();

    const amountEl = document.getElementById('amount');
    const baseCurrencyEl = document.getElementById('baseCurrency');
    const targetCurrencyEl = document.getElementById('targetCurrency');
    const rateEl = document.getElementById('rate');
    const cardFeeEl = document.getElementById('cardFee');
    const networkFeeEl = document.getElementById('networkFee');
    const flatFeeEl = document.getElementById('flatFee');
    const dccRateEl = document.getElementById('dccRate');
    const scenarioEl = document.getElementById('scenarioLabel');
    const amountCurrencyLabel = document.getElementById('amountCurrencyLabel');
    const btnFetchRate = document.getElementById('btnFetchRate');
    const btnReset = document.getElementById('btnReset');
    const rateStatus = document.getElementById('rateStatus');

    const finalAmount = document.getElementById('finalAmount');
    const effectiveRate = document.getElementById('effectiveRate');
    const baseConverted = document.getElementById('baseConverted');
    const percentFees = document.getElementById('percentFees');
    const flatFeeAmount = document.getElementById('flatFeeAmount');
    const markupPercent = document.getElementById('markupPercent');
    const dccSummary = document.getElementById('dccSummary');
    const deltaInfo = document.getElementById('deltaInfo');
    const scenarioDisplay = document.getElementById('scenarioDisplay');

    const currencyList = [
      { code:'KRW', label:'KRW · 대한민국 원', symbol:'₩' },
      { code:'USD', label:'USD · 미국 달러', symbol:'$' },
      { code:'EUR', label:'EUR · 유로', symbol:'€' },
      { code:'JPY', label:'JPY · 일본 엔', symbol:'¥' },
      { code:'CNY', label:'CNY · 중국 위안', symbol:'¥' },
      { code:'HKD', label:'HKD · 홍콩 달러', symbol:'HK$' },
      { code:'SGD', label:'SGD · 싱가포르 달러', symbol:'S$' },
      { code:'AUD', label:'AUD · 호주 달러', symbol:'A$' },
      { code:'CAD', label:'CAD · 캐나다 달러', symbol:'C$' },
      { code:'TWD', label:'TWD · 대만 달러', symbol:'NT$' },
      { code:'THB', label:'THB · 태국 바트', symbol:'฿' },
      { code:'GBP', label:'GBP · 영국 파운드', symbol:'£' },
      { code:'CHF', label:'CHF · 스위스 프랑', symbol:'Fr' }
    ];

    function populateSelect(selectEl, selected){
      selectEl.innerHTML = '';
      currencyList.forEach(cur => {
        const opt = document.createElement('option');
        opt.value = cur.code;
        opt.textContent = cur.label;
        if (cur.code === selected) opt.selected = true;
        selectEl.appendChild(opt);
      });
    }

    populateSelect(baseCurrencyEl, 'USD');
    populateSelect(targetCurrencyEl, 'KRW');

    function parseNumber(el){
      const val = parseFloat((el.value || '').replace(/,/g, ''));
      return isFinite(val) ? val : 0;
    }

    function getCurrencyMeta(code){
      return currencyList.find(cur => cur.code === code) || { code, symbol: code + ' ' };
    }

    function formatCurrency(value, code){
      if (!isFinite(value)) return '-';
      try {
        return new Intl.NumberFormat('ko-KR', { style:'currency', currency:code, maximumFractionDigits:2 }).format(value);
      } catch (err) {
        return `${getCurrencyMeta(code).symbol}${value.toFixed(2)}`;
      }
    }

    function formatNumber(value, digits = 2){
      if (!isFinite(value)) return '-';
      return new Intl.NumberFormat('ko-KR', { maximumFractionDigits:digits }).format(value);
    }

    function updateScenarioTag(){
      const label = (scenarioEl.value || '').trim();
      scenarioDisplay.textContent = label ? `시나리오: ${label}` : '시나리오: 기본';
    }

    function calculate(){
      const amount = parseNumber(amountEl);
      const rate = parseNumber(rateEl);
      const cardFee = parseNumber(cardFeeEl);
      const networkFee = parseNumber(networkFeeEl);
      const flatFee = parseNumber(flatFeeEl);
      const dccRate = parseNumber(dccRateEl);
      const baseCur = baseCurrencyEl.value;
      const targetCur = targetCurrencyEl.value;

      amountCurrencyLabel.textContent = baseCur;

      if (!amount || !rate) {
        finalAmount.textContent = formatCurrency(0, targetCur);
        effectiveRate.textContent = '적용 환율: -';
        baseConverted.textContent = '-';
        percentFees.textContent = '-';
        flatFeeAmount.textContent = '-';
        markupPercent.textContent = '-';
        dccSummary.textContent = '환율과 수수료를 입력하면 결과가 표시됩니다.';
        deltaInfo.textContent = '실제 적용 환율은 입력한 기준 환율과 동일하게 시작합니다.';
        return;
      }

      const baseConvertedValue = amount * rate;
      const percentFeeRate = (cardFee + networkFee) / 100;
      const percentFeeAmount = baseConvertedValue * percentFeeRate;
      const total = baseConvertedValue + percentFeeAmount + flatFee;
      const effective = amount > 0 ? total / amount : 0;
      const markupRate = rate > 0 ? ((effective - rate) / rate) * 100 : 0;

      finalAmount.textContent = formatCurrency(total, targetCur);
      effectiveRate.textContent = `적용 환율: ${formatNumber(effective, 4)} ${targetCur} / ${baseCur}`;
      baseConverted.textContent = formatCurrency(baseConvertedValue, targetCur);
      percentFees.textContent = `${formatCurrency(percentFeeAmount, targetCur)} (${formatNumber((cardFee + networkFee), 2)}%)`;
      flatFeeAmount.textContent = formatCurrency(flatFee, targetCur);
      markupPercent.textContent = `${formatNumber(markupRate, 2)}%`;

      const deltaText = markupRate > 0
        ? `기준 환율 대비 총 ${formatNumber(markupRate, 2)}%의 마크업이 반영되었습니다.`
        : '현재 입력값으로는 기준 환율보다 낮은 환율이 적용되었습니다.';
      deltaInfo.textContent = deltaText;

      if (dccRate > 0) {
        const dccTotal = amount * dccRate;
        const diff = dccTotal - total;
        const diffAbs = Math.abs(diff);
        const descriptor = diff > 0 ? '현지 통화 결제 시 절감 예상' : '현지 통화 결제 시 추가 부담';
        dccSummary.innerHTML = `원화결제 시 예상 금액은 <strong>${formatCurrency(dccTotal, targetCur)}</strong> 입니다.<br>` +
          `${descriptor}: <strong>${formatCurrency(diffAbs, targetCur)}</strong> (${formatNumber((diff / total) * 100, 2)}%).`;
      } else {
        dccSummary.textContent = 'DCC 환율을 입력하면 현지 통화 결제와 원화결제의 차이를 계산해줍니다.';
      }
    }

    baseCurrencyEl.addEventListener('change', () => {
      amountCurrencyLabel.textContent = baseCurrencyEl.value;
      calculate();
    });
    targetCurrencyEl.addEventListener('change', calculate);
    amountEl.addEventListener('input', calculate);
    rateEl.addEventListener('input', calculate);
    cardFeeEl.addEventListener('input', calculate);
    networkFeeEl.addEventListener('input', calculate);
    flatFeeEl.addEventListener('input', calculate);
    dccRateEl.addEventListener('input', calculate);
    scenarioEl.addEventListener('input', updateScenarioTag);

    btnReset?.addEventListener('click', () => {
      amountEl.value = '120';
      baseCurrencyEl.value = 'USD';
      targetCurrencyEl.value = 'KRW';
      rateEl.value = '1320';
      cardFeeEl.value = '1.0';
      networkFeeEl.value = '0.8';
      flatFeeEl.value = '0';
      dccRateEl.value = '';
      scenarioEl.value = '';
      amountCurrencyLabel.textContent = 'USD';
      rateStatus.textContent = "Tip: 환율은 1 결제 통화당 정산 통화 금액을 입력합니다. (예: 1 USD = 1320 KRW)";
      updateScenarioTag();
      calculate();
    });

    async function fetchRate(){
      const base = baseCurrencyEl.value;
      const target = targetCurrencyEl.value;
      rateStatus.textContent = '환율 조회 중입니다…';
      btnFetchRate.disabled = true;
      btnFetchRate.classList.add('opacity-60');
      try {
        const url = `https://open.er-api.com/v6/latest/${base}`;
        const res = await fetch(url);
        if (!res.ok) throw new Error('HTTP '+res.status);
        const data = await res.json();
        if (data.result !== 'success' || !data.rates) throw new Error('API 응답 오류');
        const rate = data.rates[target];
        if (!rate) throw new Error('선택한 통화 조합 지원 안함');
        rateEl.value = Number(rate).toFixed(4);
        rateStatus.textContent = `실시간 환율 반영: 1 ${base} ≈ ${formatNumber(rate, 4)} ${target} (기준시각: ${data.time_last_update_utc || 'N/A'})`;
        calculate();
      } catch (err) {
        console.error(err);
        rateStatus.textContent = '환율 조회에 실패했습니다. 네트워크를 확인하거나 직접 환율을 입력하세요.';
      } finally {
        btnFetchRate.disabled = false;
        btnFetchRate.classList.remove('opacity-60');
      }
    }

    btnFetchRate?.addEventListener('click', fetchRate);

    updateScenarioTag();
    calculate();
  });
  </script>
</body>
</html>
