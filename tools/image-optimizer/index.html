<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>이미지 압축(WebP·AVIF) — 용량은 작게, 화질은 그대로 | Yuchani Tools pro</title>
  <meta name="description" content="이미지를 WebP·AVIF로 고품질 압축하세요. 드래그&드롭, 일괄 변환, 화질 조절, 용량 절감 통계를 한 번에 제공합니다." />
  <link rel="canonical" href="https://tools.yuchani.com/tools/image-optimizer/" />
  <meta name="robots" content="index,follow" />

  <!-- Open Graph / Twitter -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="이미지 압축(WebP·AVIF) — 용량은 작게, 화질은 그대로" />
  <meta property="og:description" content="사이트 속도는 높이고 용량은 줄이는 전문가용 이미지 압축기. 브라우저에서 안전하게 WebP·AVIF 출력." />
  <meta property="og:url" content="https://tools.yuchani.com/tools/image-optimizer/" />
  <meta property="og:image" content="/og/cover.png" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- JSON-LD: SoftwareApplication -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"SoftwareApplication",
    "name":"이미지 압축(WebP·AVIF)",
    "applicationCategory":"MultimediaApplication",
    "operatingSystem":"Web",
    "url":"https://tools.yuchani.com/tools/image-optimizer/",
    "description":"이미지 WebP·AVIF 압축기",
    "softwareVersion":"1.0",
    "offers":{"@type":"Offer","price":"0","priceCurrency":"KRW"}
  }
  </script>
  <!-- JSON-LD: FAQPage -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"FAQPage",
    "mainEntity":[
      {"@type":"Question","name":"이미지를 어떻게 업로드하나요?","acceptedAnswer":{"@type":"Answer","text":"파일 선택 버튼을 누르거나 압축하고 싶은 이미지를 화면으로 끌어다 놓으면 됩니다. 여러 장도 동시에 처리할 수 있습니다."}},
      {"@type":"Question","name":"WebP와 AVIF 중 무엇을 선택해야 하나요?","acceptedAnswer":{"@type":"Answer","text":"WebP는 폭넓은 브라우저 호환성이 장점이고, AVIF는 더 높은 압축률을 기대할 수 있습니다. 두 형식을 동시에 생성해 비교할 수 있습니다."}},
      {"@type":"Question","name":"화질 조절은 어떻게 하나요?","acceptedAnswer":{"@type":"Answer","text":"우측 옵션에서 화질 슬라이더를 조정하면 됩니다. 기본값은 85%이며, 70% 안팎이 일반적인 웹 최적화에 적합합니다."}},
      {"@type":"Question","name":"압축 과정에서 개인정보가 서버로 전송되나요?","acceptedAnswer":{"@type":"Answer","text":"모든 처리는 브라우저 안에서만 실행됩니다. 업로드한 이미지가 외부 서버로 전송되지 않으므로 안심하고 사용하세요."}},
      {"@type":"Question","name":"변환이 지원되지 않는 브라우저는 어떻게 되나요?","acceptedAnswer":{"@type":"Answer","text":"브라우저가 해당 형식을 지원하지 않을 경우 자동으로 비활성화되며, 지원 여부를 화면에 표시해드립니다."}}
    ]
  }
  </script>

  <!-- Tailwind & Icons -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    :root { color-scheme: dark; }
    body { background:#0F1113; padding-bottom: env(safe-area-inset-bottom); }
    .panel { background:#11151b; }
    .ring-soft { box-shadow: inset 0 0 0 1px rgba(255,255,255,0.08); }
    .brand-grad { background-image:linear-gradient(90deg,#a855f7,#22d3ee); }
  </style>
</head>
<body class="text-white">
  <div data-include="/partials/header.html"></div>

  <main class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8">
    <header class="mb-8 text-center md:text-left">
      <p class="inline-flex items-center gap-2 text-xs font-semibold uppercase tracking-[0.3em] text-white/50">Speed · SEO · UX</p>
      <h1 class="mt-3 text-3xl md:text-4xl lg:text-5xl font-black tracking-tight">
        <span class="brand-grad bg-clip-text text-transparent">이미지 압축(WebP·AVIF)</span>
      </h1>
      <p class="mt-4 text-base md:text-lg text-white/70 leading-relaxed">
        용량은 <strong>최대 90% 이상 절감</strong>하고, 화질은 그대로 유지하세요. 브라우저에서 즉시 처리되는 전문가용 압축기로 사이트 속도와 SEO 점수를 동시에 끌어올립니다.
      </p>
      <div class="mt-4 flex flex-wrap gap-2 text-xs justify-center md:justify-start">
        <span class="px-3 py-1 rounded-full border border-emerald-400/40 bg-emerald-400/10 text-emerald-200">서버 전송 없음</span>
        <span class="px-3 py-1 rounded-full border border-sky-400/40 bg-sky-400/10 text-sky-200">반응형 · 모바일 최적화</span>
        <span class="px-3 py-1 rounded-full border border-purple-400/40 bg-purple-400/10 text-purple-200">일괄 변환 지원</span>
      </div>
    </header>

    <section class="grid lg:grid-cols-[1.1fr,0.9fr] gap-6 items-start">
      <!-- 업로드 영역 -->
      <div class="rounded-3xl border border-white/10 ring-soft panel p-6">
        <div id="dropzone" class="relative rounded-2xl border-2 border-dashed border-white/15 bg-white/5 p-6 md:p-10 text-center transition-all">
          <div class="mx-auto flex flex-col items-center gap-3 max-w-md">
            <span class="w-14 h-14 rounded-full bg-white/10 border border-white/20 grid place-items-center">
              <i data-lucide="image" class="w-7 h-7 text-sky-200"></i>
            </span>
            <div class="text-lg font-semibold">이미지를 여기에 끌어다 놓거나 클릭해서 업로드</div>
            <p class="text-sm text-white/60 leading-relaxed">JPG, PNG, GIF, TIFF 등 주요 포맷을 지원합니다. 최대 30장까지 한 번에 변환하세요.</p>
            <label class="mt-3 inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-white text-black text-sm font-semibold cursor-pointer shadow">
              <i data-lucide="upload" class="w-4 h-4"></i>
              <span>파일 선택</span>
              <input id="fileInput" type="file" accept="image/*" multiple class="hidden" />
            </label>
          </div>
          <div id="dropOverlay" class="pointer-events-none absolute inset-0 rounded-2xl border-2 border-emerald-400/70 bg-emerald-400/10 opacity-0 transition-opacity"></div>
        </div>

        <div class="mt-6">
          <div class="flex items-center justify-between text-sm">
            <h2 class="font-semibold text-white/80 flex items-center gap-2"><i data-lucide="folder-open" class="w-4 h-4"></i> 선택한 이미지</h2>
            <button id="clearAll" class="text-xs text-white/60 hover:text-white/90">전체 비우기</button>
          </div>
          <ul id="fileList" class="mt-3 space-y-2 text-sm text-white/70 max-h-56 overflow-auto pr-1">
            <li class="text-white/40">아직 선택된 이미지가 없습니다.</li>
          </ul>
        </div>
      </div>

      <!-- 옵션 패널 -->
      <aside class="rounded-3xl border border-white/10 ring-soft panel p-6 space-y-6">
        <section>
          <h2 class="text-sm font-semibold text-white/70 uppercase tracking-[0.2em]">OUTPUT FORMAT</h2>
          <div class="mt-3 grid grid-cols-2 gap-3 text-sm">
            <label class="flex items-center gap-2 rounded-2xl border border-emerald-400/30 bg-emerald-400/10 px-3 py-2">
              <input type="checkbox" name="format" value="image/webp" checked class="accent-emerald-400">
              <span class="font-medium">WebP</span>
              <span id="webpBadge" class="ml-auto text-xs text-emerald-200 bg-emerald-500/20 px-2 py-0.5 rounded-full">지원</span>
            </label>
            <label class="flex items-center gap-2 rounded-2xl border border-cyan-400/30 bg-cyan-400/10 px-3 py-2">
              <input type="checkbox" name="format" value="image/avif" checked class="accent-cyan-400">
              <span class="font-medium">AVIF</span>
              <span id="avifBadge" class="ml-auto text-xs text-cyan-200 bg-cyan-500/20 px-2 py-0.5 rounded-full">지원</span>
            </label>
          </div>
        </section>

        <section>
          <h2 class="text-sm font-semibold text-white/70 uppercase tracking-[0.2em]">QUALITY</h2>
          <div class="mt-3">
            <input id="quality" type="range" min="40" max="100" value="85" class="w-full accent-emerald-400">
            <div class="mt-2 flex items-center justify-between text-sm text-white/60">
              <span>웹 최적</span>
              <span id="qualityValue" class="text-white/90 font-semibold">85%</span>
            </div>
          </div>
        </section>

        <section class="space-y-3 text-sm text-white/70">
          <label class="flex items-center justify-between gap-3">
            <span class="font-medium flex items-center gap-2"><i data-lucide="sparkles" class="w-4 h-4"></i> 자동 변환</span>
            <input id="autoConvert" type="checkbox" class="accent-emerald-400">
          </label>
          <label class="flex items-center justify-between gap-3">
            <span class="font-medium flex items-center gap-2"><i data-lucide="crop" class="w-4 h-4"></i> 원본 해상도 유지</span>
            <span class="text-xs text-white/50">(기본)</span>
          </label>
          <p class="text-xs text-white/50 leading-relaxed">필요하다면 추후 해상도 조절 옵션이 추가될 예정입니다. 현재 버전은 원본의 픽셀을 그대로 유지합니다.</p>
        </section>

        <button id="convertBtn" class="w-full inline-flex items-center justify-center gap-2 rounded-2xl bg-gradient-to-r from-emerald-400 to-sky-400 text-black font-semibold py-3 text-base shadow-lg shadow-emerald-500/20 disabled:opacity-60 disabled:cursor-not-allowed">
          <i data-lucide="wand2" class="w-5 h-5"></i>
          압축 시작
        </button>

        <div id="statsSummary" class="rounded-2xl border border-white/10 bg-white/5 p-4 text-sm text-white/70 space-y-1">
          <div class="font-semibold text-white/80">압축 요약</div>
          <p class="text-white/50">이미지를 선택하면 통계가 표시됩니다.</p>
        </div>
      </aside>
    </section>

    <!-- 결과 영역 -->
    <section class="mt-10">
      <div class="flex items-center justify-between flex-wrap gap-3">
        <h2 class="text-xl font-semibold text-white/90 flex items-center gap-2">
          <i data-lucide="gauge" class="w-5 h-5 text-emerald-300"></i> 압축 결과
        </h2>
        <div id="resultMeta" class="text-sm text-white/50"></div>
      </div>
      <div id="resultList" class="mt-4 grid gap-4 md:grid-cols-2 xl:grid-cols-3">
        <div class="rounded-2xl border border-white/10 bg-white/5 p-6 text-sm text-white/60">
          <p>출력된 파일이 여기 표시됩니다. 화질과 용량을 비교하고, 필요하면 즉시 다운로드하세요.</p>
        </div>
      </div>
    </section>

    <!-- 도움말 & FAQ -->
    <section class="mt-14 grid gap-6 lg:grid-cols-2">
      <article class="rounded-3xl border border-white/10 ring-soft panel p-6">
        <h2 class="text-lg font-semibold text-white/90 flex items-center gap-2">
          <i data-lucide="life-buoy" class="w-5 h-5 text-sky-300"></i> 사용 도움말 &amp; 팁
        </h2>
        <ul class="mt-4 space-y-3 text-sm text-white/70 leading-relaxed">
          <li class="flex gap-3">
            <span class="mt-1 w-2 h-2 rounded-full bg-emerald-400"></span>
            <div><strong>품질 75~85%</strong>가 일반적인 웹사이트 최적화의 스윗 스팟입니다. 너무 낮추면 밴딩이 생길 수 있어요.</div>
          </li>
          <li class="flex gap-3">
            <span class="mt-1 w-2 h-2 rounded-full bg-emerald-400"></span>
            <div>동일 이미지를 두 형식으로 변환해두면, <strong>브라우저 호환성</strong>과 <strong>압축률</strong>을 모두 확보할 수 있습니다.</div>
          </li>
          <li class="flex gap-3">
            <span class="mt-1 w-2 h-2 rounded-full bg-emerald-400"></span>
            <div>결과 카드에서 <strong>다운로드 버튼</strong>을 누르면 새 탭 없이 즉시 저장할 수 있습니다.</div>
          </li>
          <li class="flex gap-3">
            <span class="mt-1 w-2 h-2 rounded-full bg-emerald-400"></span>
            <div>SEO를 위해서는 <strong>원본 파일명과 ALT 텍스트</strong>도 함께 정리해두는 것이 좋습니다.</div>
          </li>
        </ul>
      </article>

      <article class="rounded-3xl border border-white/10 ring-soft panel p-6">
        <h2 class="text-lg font-semibold text-white/90 flex items-center gap-2">
          <i data-lucide="book-open" class="w-5 h-5 text-purple-300"></i> 사용 설명서 &amp; FAQ
        </h2>
        <div class="mt-4 space-y-3 text-sm text-white/70 leading-relaxed">
          <details class="rounded-2xl border border-white/10 bg-white/5 p-4" open>
            <summary class="font-semibold text-white">1. 이미지 업로드</summary>
            <p class="mt-2 text-white/70">드래그&드롭 또는 파일 선택 버튼으로 최대 30장의 이미지를 한 번에 가져올 수 있습니다. 순서는 그대로 유지됩니다.</p>
          </details>
          <details class="rounded-2xl border border-white/10 bg-white/5 p-4">
            <summary class="font-semibold text-white">2. 옵션 조정</summary>
            <p class="mt-2 text-white/70">WebP/AVIF 중 원하는 형식을 선택하고, 화질 슬라이더로 목표 품질을 설정하세요. 자동 변환을 켜면 파일 추가 시 즉시 압축됩니다.</p>
          </details>
          <details class="rounded-2xl border border-white/10 bg-white/5 p-4">
            <summary class="font-semibold text-white">3. 결과 확인 &amp; 다운로드</summary>
            <p class="mt-2 text-white/70">각 카드에는 미리보기, 용량 비교, 저장 버튼이 표시됩니다. 필요하면 결과 이미지를 클릭하여 새 탭에서 확인할 수 있습니다.</p>
          </details>
          <details class="rounded-2xl border border-white/10 bg-white/5 p-4">
            <summary class="font-semibold text-white">4. 속도 최적화 팁</summary>
            <p class="mt-2 text-white/70">웹페이지에는 200KB 이하의 이미지가 이상적입니다. 큰 배경 이미지는 CSS에서 lazy-load하거나 AVIF를 우선 적용하세요.</p>
          </details>
        </div>
      </article>
    </section>
  </main>

  <div data-include="/partials/footer.html"></div>
  <script defer src="/inject-layout.js?v=7"></script>
  <script>
    const fileInput = document.getElementById('fileInput');
    const dropzone = document.getElementById('dropzone');
    const dropOverlay = document.getElementById('dropOverlay');
    const fileListEl = document.getElementById('fileList');
    const clearAllBtn = document.getElementById('clearAll');
    const convertBtn = document.getElementById('convertBtn');
    const formatsEl = Array.from(document.querySelectorAll('input[name="format"]'));
    const webpBadge = document.getElementById('webpBadge');
    const avifBadge = document.getElementById('avifBadge');
    const qualityInput = document.getElementById('quality');
    const qualityValue = document.getElementById('qualityValue');
    const autoConvert = document.getElementById('autoConvert');
    const statsSummary = document.getElementById('statsSummary');
    const resultList = document.getElementById('resultList');
    const resultMeta = document.getElementById('resultMeta');

    const state = {
      files: [],
      results: [],
      support: {
        webp: false,
        avif: false,
      }
    };

    function cleanupResults() {
      state.results.forEach(item => {
        try {
          if (item.result?.url) URL.revokeObjectURL(item.result.url);
        } catch (e) {
          console.warn('URL revoke 실패', e);
        }
      });
      state.results = [];
    }

    function detectSupport(type) {
      const canvas = document.createElement('canvas');
      try {
        const data = canvas.toDataURL(type);
        return data.startsWith(`data:${type}`);
      } catch (e) {
        return false;
      }
    }

    function initSupport() {
      state.support.webp = detectSupport('image/webp');
      state.support.avif = detectSupport('image/avif');

      if (!state.support.webp) {
        const checkbox = formatsEl.find(el => el.value === 'image/webp');
        checkbox.checked = false;
        checkbox.disabled = true;
        webpBadge.textContent = '미지원';
        webpBadge.className = 'ml-auto text-xs text-amber-200 bg-amber-500/20 px-2 py-0.5 rounded-full';
      }
      if (!state.support.avif) {
        const checkbox = formatsEl.find(el => el.value === 'image/avif');
        checkbox.checked = false;
        checkbox.disabled = true;
        avifBadge.textContent = '미지원';
        avifBadge.className = 'ml-auto text-xs text-amber-200 bg-amber-500/20 px-2 py-0.5 rounded-full';
      }
    }

    function formatBytes(bytes) {
      if (!Number.isFinite(bytes)) return '-';
      const units = ['B', 'KB', 'MB', 'GB'];
      let idx = 0;
      let value = bytes;
      while (value >= 1024 && idx < units.length - 1) {
        value /= 1024;
        idx++;
      }
      return `${value.toFixed(value >= 10 || idx === 0 ? 0 : 1)} ${units[idx]}`;
    }

    function updateFileList() {
      fileListEl.innerHTML = '';
      if (!state.files.length) {
        fileListEl.innerHTML = '<li class="text-white/40">아직 선택된 이미지가 없습니다.</li>';
      } else {
        const frag = document.createDocumentFragment();
        state.files.forEach((file, index) => {
          const li = document.createElement('li');
          li.className = 'rounded-2xl border border-white/10 bg-white/5 px-3 py-2 flex items-center gap-3';
          li.innerHTML = `
            <span class="text-xs text-white/50">${index + 1}.</span>
            <span class="flex-1 truncate">${file.name}</span>
            <span class="text-xs text-white/40">${formatBytes(file.size)}</span>
          `;
          frag.appendChild(li);
        });
        fileListEl.appendChild(frag);
      }
      convertBtn.disabled = !state.files.length || !selectedFormats().length;
      updateStats();
    }

    function selectedFormats() {
      return formatsEl.filter(el => el.checked && !el.disabled).map(el => el.value);
    }

    function clampFiles(fileList) {
      const files = Array.from(fileList || []).filter(file => file.type.startsWith('image/'));
      const combined = [...state.files, ...files];
      if (combined.length > 30) {
        combined.length = 30;
      }
      state.files = combined;
      updateFileList();
      if (autoConvert.checked) {
        convertAll();
      }
    }

    function resetAll() {
      cleanupResults();
      state.files = [];
      fileInput.value = '';
      updateFileList();
      resultList.innerHTML = '<div class="rounded-2xl border border-white/10 bg-white/5 p-6 text-sm text-white/60"><p>출력된 파일이 여기 표시됩니다. 화질과 용량을 비교하고, 필요하면 즉시 다운로드하세요.</p></div>';
      resultMeta.textContent = '';
    }

    async function readImage(file) {
      const bitmap = await createImageBitmap(file);
      const canvas = document.createElement('canvas');
      canvas.width = bitmap.width;
      canvas.height = bitmap.height;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(bitmap, 0, 0);
      bitmap.close?.();
      return { canvas, ctx };
    }

    function toBlob(canvas, type, quality) {
      return new Promise((resolve, reject) => {
        canvas.toBlob(blob => {
          if (blob) resolve(blob);
          else reject(new Error('압축에 실패했습니다.'));
        }, type, quality);
      });
    }

    async function convertFile(file, type, quality) {
      const { canvas } = await readImage(file);
      const blob = await toBlob(canvas, type, quality);
      const url = URL.createObjectURL(blob);
      return {
        blob,
        url,
        width: canvas.width,
        height: canvas.height,
      };
    }

    function formatLabel(type) {
      return type === 'image/avif' ? 'AVIF' : 'WebP';
    }

    function updateStats() {
      if (!state.files.length) {
        statsSummary.innerHTML = '<div class="font-semibold text-white/80">압축 요약</div><p class="text-white/50">이미지를 선택하면 통계가 표시됩니다.</p>';
        return;
      }
      const totalOriginal = state.files.reduce((sum, file) => sum + file.size, 0);
      if (!state.results.length) {
        statsSummary.innerHTML = `
          <div class="font-semibold text-white/80">압축 대기중</div>
          <p class="text-white/60">${state.files.length}개의 이미지 · 원본 합계 ${formatBytes(totalOriginal)}</p>
        `;
        return;
      }
      const aggregates = state.results.reduce((acc, item) => {
        if (!acc[item.type]) acc[item.type] = { size: 0, count: 0 };
        acc[item.type].size += item.result.blob.size;
        acc[item.type].count += 1;
        return acc;
      }, {});
      const parts = Object.entries(aggregates).map(([type, data]) => {
        const ratio = totalOriginal ? (1 - data.size / totalOriginal) * 100 : 0;
        const badge = ratio > 0 ? `↓${ratio.toFixed(0)}%` : ratio < 0 ? `+${Math.abs(ratio).toFixed(0)}%` : '동일';
        return `<li class="flex items-center justify-between gap-3"><span>${formatLabel(type)} · ${data.count}개</span><span class="text-white/50">${formatBytes(data.size)} (${badge})</span></li>`;
      }).join('');
      statsSummary.innerHTML = `
        <div class="font-semibold text-white/80">압축 완료</div>
        <p class="text-white/60">원본 ${formatBytes(totalOriginal)} 대비 형식별 절감률</p>
        <ul class="mt-3 space-y-1 text-sm">${parts}</ul>
      `;
    }

    function addResultCard({ file, result, type }) {
      const ratio = file.size ? (1 - result.blob.size / file.size) * 100 : 0;
      const ratioLabel = ratio > 0 ? `-${ratio.toFixed(0)}%` : ratio < 0 ? `+${Math.abs(ratio).toFixed(0)}%` : '0%';
      const card = document.createElement('article');
      card.className = 'rounded-3xl border border-white/10 bg-gradient-to-br from-white/10 via-white/5 to-white/0 p-5 flex flex-col gap-4';
      card.innerHTML = `
        <header class="flex items-center gap-3">
          <span class="w-10 h-10 rounded-2xl bg-white/10 border border-white/10 grid place-items-center">
            <i data-lucide="layers" class="w-5 h-5 text-emerald-200"></i>
          </span>
          <div class="min-w-0">
            <div class="text-sm font-semibold text-white/90 truncate">${file.name}</div>
            <div class="text-xs text-white/50">${formatLabel(type)} · ${result.width}×${result.height}px</div>
          </div>
        </header>
        <div class="rounded-2xl overflow-hidden border border-white/10 bg-black/20">
          <img src="${result.url}" alt="${file.name} (${formatLabel(type)})" class="w-full h-44 object-contain bg-black/10" loading="lazy" />
        </div>
        <dl class="grid grid-cols-2 gap-3 text-sm text-white/70">
          <div>
            <dt class="text-xs text-white/50">원본</dt>
            <dd class="font-semibold text-white/80">${formatBytes(file.size)}</dd>
          </div>
          <div>
            <dt class="text-xs text-white/50">압축본</dt>
            <dd class="font-semibold text-emerald-200">${formatBytes(result.blob.size)}</dd>
          </div>
          <div class="col-span-2 text-xs text-white/60">절감률 <span class="font-semibold text-emerald-300">${ratioLabel}</span></div>
        </dl>
        <div class="flex flex-wrap gap-2">
          <a href="${result.url}" download="${file.name.replace(/\.[^/.]+$/, '')}_${formatLabel(type).toLowerCase()}.${type === 'image/avif' ? 'avif' : 'webp'}" class="inline-flex items-center gap-2 px-3 py-2 rounded-2xl bg-emerald-400/20 border border-emerald-400/40 text-emerald-100 text-sm font-medium hover:bg-emerald-400/30">
            <i data-lucide="download" class="w-4 h-4"></i>
            다운로드
          </a>
          <button class="inline-flex items-center gap-2 px-3 py-2 rounded-2xl bg-white/10 border border-white/20 text-white/70 text-sm hover:bg-white/15" data-action="preview" data-url="${result.url}">
            <i data-lucide="external-link" class="w-4 h-4"></i>
            새 탭으로 보기
          </button>
        </div>
      `;
      resultList.appendChild(card);
    }

    async function convertAll() {
      const formats = selectedFormats();
      if (!state.files.length || !formats.length) return;

      convertBtn.disabled = true;
      resultList.innerHTML = '';
      cleanupResults();
      state.results = [];
      resultMeta.textContent = '압축 중… 잠시만 기다려주세요.';

      const quality = Number(qualityInput.value) / 100;

      for (const file of state.files) {
        for (const type of formats) {
          try {
            const result = await convertFile(file, type, quality);
            state.results.push({ file, result, type });
            addResultCard({ file, result, type });
            if (window.lucide?.createIcons) {
              window.lucide.createIcons();
            }
          } catch (error) {
            const card = document.createElement('article');
            card.className = 'rounded-3xl border border-rose-500/30 bg-rose-500/10 p-5 text-sm text-rose-100';
            card.innerHTML = `
              <div class="font-semibold mb-1">${file.name} 변환 실패</div>
              <p>${error.message}</p>
            `;
            resultList.appendChild(card);
          }
        }
      }

      const totalResults = state.results.length;
      resultMeta.textContent = `${totalResults}개의 압축본 생성 완료`;
      convertBtn.disabled = false;
      updateStats();
    }

    function handlePreviewClick(event) {
      const button = event.target.closest('button[data-action="preview"]');
      if (!button) return;
      const url = button.getAttribute('data-url');
      window.open(url, '_blank');
    }

    fileInput.addEventListener('change', (e) => {
      clampFiles(e.target.files);
    });

    clearAllBtn.addEventListener('click', () => {
      resetAll();
    });

    convertBtn.addEventListener('click', () => {
      convertAll();
    });

    qualityInput.addEventListener('input', () => {
      qualityValue.textContent = qualityInput.value + '%';
      if (autoConvert.checked && state.results.length) {
        convertAll();
      }
    });

    formatsEl.forEach(el => {
      el.addEventListener('change', () => {
        convertBtn.disabled = !state.files.length || !selectedFormats().length;
      });
    });

    ;['dragenter','dragover'].forEach(evt => {
      dropzone.addEventListener(evt, (event) => {
        event.preventDefault();
        event.stopPropagation();
        dropOverlay.style.opacity = '1';
        dropzone.classList.add('ring-2','ring-emerald-400/60');
      });
    });

    ;['dragleave','dragend','drop'].forEach(evt => {
      dropzone.addEventListener(evt, (event) => {
        dropOverlay.style.opacity = '0';
        dropzone.classList.remove('ring-2','ring-emerald-400/60');
      });
    });

    dropzone.addEventListener('drop', (event) => {
      event.preventDefault();
      clampFiles(event.dataTransfer.files);
    });

    dropzone.addEventListener('click', () => fileInput.click());
    resultList.addEventListener('click', handlePreviewClick);

    initSupport();
    updateFileList();

    document.addEventListener('DOMContentLoaded', () => {
      if (window.lucide?.createIcons) {
        window.lucide.createIcons();
      }
    });

    window.addEventListener('beforeunload', cleanupResults);
  </script>
</body>
</html>
