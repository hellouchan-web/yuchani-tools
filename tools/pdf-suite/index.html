<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PDF 합치기 · 분할 · 압축 — 초고속 브라우저 웹툴 | Yuchani Tools pro</title>
  <meta name="description" content="여러 PDF를 한 번에 합치고, 원하는 페이지 범위만 분할하거나 용량을 줄여 메일 첨부에 최적화합니다. 모든 작업은 브라우저에서 즉시 처리되어 데이터가 서버로 업로드되지 않습니다." />
  <link rel="canonical" href="https://tools.yuchani.com/tools/pdf-suite/" />
  <meta name="robots" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1" />

  <!-- Open Graph / Twitter -->
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Yuchani Tools pro" />
  <meta property="og:title" content="PDF 합치기 · 분할 · 압축 — 초고속 브라우저 웹툴" />
  <meta property="og:description" content="여러 PDF를 합치고, 범위 분할, 압축까지. 개인정보는 안전하게, 속도는 초고속." />
  <meta property="og:url" content="https://tools.yuchani.com/tools/pdf-suite/" />
  <meta property="og:image" content="https://tools.yuchani.com/assets/og.jpg" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="PDF 합치기 · 분할 · 압축 — 초고속 웹툴" />
  <meta name="twitter:description" content="드래그앤드롭으로 합치고 분할하고 압축하세요. 모든 처리 100% 로컬." />
  <meta name="twitter:image" content="https://tools.yuchani.com/assets/og.jpg" />

  <link rel="alternate" href="https://tools.yuchani.com/tools/pdf-suite/" hreflang="ko" />
  <link rel="alternate" href="https://tools.yuchani.com/en/tools/pdf-suite/" hreflang="en" />
  <link rel="alternate" href="https://tools.yuchani.com/tools/pdf-suite/" hreflang="x-default" />

  <!-- Tailwind & Icons -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <!-- PDF Libraries -->
  <script defer src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js"></script>

  <style>
    :root { color-scheme: dark; }
    body { background:#0F1113; }
    .ring-soft { box-shadow: inset 0 0 0 1px rgba(255,255,255,.08); }
    .panel { background:#111418; }
    .brand-grad { background-image: linear-gradient(120deg,#f97316,#60a5fa); }
    .glass { background: rgba(17,20,24,0.75); backdrop-filter: blur(18px); border:1px solid rgba(255,255,255,0.08); }
    .drop-active { border-color: rgba(129, 230, 217, 0.6) !important; background: rgba(16, 185, 129, 0.08); }
  </style>

  <!-- JSON-LD: WebApplication -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "PDF 합치기·분할·압축",
    "applicationCategory": "UtilityApplication",
    "operatingSystem": "Web",
    "url": "https://tools.yuchani.com/tools/pdf-suite/",
    "offers": {"@type": "Offer", "price": "0", "priceCurrency": "KRW"},
    "featureList": ["PDF 병합", "페이지 범위 분할", "압축/경량화", "로컬 처리", "드래그앤드롭"],
    "description": "여러 PDF를 하나로 합치고, 페이지 단위로 분할하며, 메일 첨부용으로 용량을 줄여주는 반응형 웹앱."
  }
  </script>

  <!-- JSON-LD: FAQPage -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "PDF가 서버로 업로드되나요?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "아니요. 모든 연산은 브라우저 메모리에서만 수행되며 네트워크로 전송되지 않습니다."
        }
      },
      {
        "@type": "Question",
        "name": "분할 시 각 페이지를 개별 파일로 받을 수 있나요?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "'전체 페이지 ZIP' 기능을 사용하면 각 페이지가 독립된 PDF로 묶인 압축 파일을 내려받습니다."
        }
      },
      {
        "@type": "Question",
        "name": "압축 품질은 조절할 수 있나요?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "무손실·표준·최고압축 세 가지 모드 중 선택할 수 있으며, 표준/최고압축은 PDF 페이지를 JPEG 이미지로 재생성해 용량을 줄입니다."
        }
      },
      {
        "@type": "Question",
        "name": "메일 첨부 최대 용량을 어떻게 맞추나요?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "압축 실행 후 결과 카드에서 감소 폭을 확인하고, 필요하면 추가로 표준/최고압축을 반복하거나 페이지 범위를 분할해 첨부하면 됩니다."
        }
      }
    ]
  }
  </script>

  <!-- JSON-LD: HowTo -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "HowTo",
    "name": "PDF 합치기·분할·압축 사용 가이드",
    "description": "업로드부터 병합·분할·압축 실행, 결과 다운로드까지 4단계 안내",
    "totalTime": "PT2M",
    "tool": ["웹 브라우저"],
    "step": [
      {"@type": "HowToStep", "name": "PDF 업로드", "text": "드래그하거나 '파일 불러오기' 버튼으로 PDF를 추가합니다."},
      {"@type": "HowToStep", "name": "작업 모드 선택", "text": "합치기·분할·압축 탭 중 원하는 기능을 선택합니다."},
      {"@type": "HowToStep", "name": "옵션 조정", "text": "페이지 범위나 압축 등급을 설정합니다."},
      {"@type": "HowToStep", "name": "다운로드", "text": "실행 버튼을 눌러 결과 파일을 내려받습니다."}
    ]
  }
  </script>
</head>
<body class="text-white">
  <!-- 공통 헤더 -->
  <div data-include="/partials/header.html"></div>

  <main class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-10 space-y-10">
    <!-- Hero -->
    <section class="relative overflow-hidden rounded-3xl border border-white/10 bg-gradient-to-br from-white/10 via-white/5 to-white/0 p-6 md:p-10">
      <div class="absolute inset-y-0 right-0 hidden md:block w-1/2 opacity-20 mix-blend-screen" aria-hidden="true">
        <div class="h-full w-full bg-[radial-gradient(circle_at_top,#60a5fa33,transparent_65%)]"></div>
      </div>
      <div class="relative max-w-3xl space-y-4">
        <p class="inline-flex items-center gap-2 rounded-full border border-white/20 bg-white/10 px-4 py-1 text-xs uppercase tracking-[0.3em] text-white/70">
          <i data-lucide="sparkles" class="h-4 w-4"></i> Premium PDF Workflow
        </p>
        <h1 class="text-3xl font-black leading-tight sm:text-4xl md:text-5xl">
          메일 첨부까지 완벽한 <span class="brand-grad bg-clip-text text-transparent">PDF 합치기·분할·압축</span>
        </h1>
        <p class="text-base text-white/70 md:text-lg">
          여러 파일을 하나로 묶고, 필요한 페이지만 분리하고, 용량을 줄여 전송까지 완료하세요. 구글 SEO 친화 메타 구조와 초경량 스크립트로 모바일·데스크톱 모두에서 반응형으로 작동합니다.
        </p>
        <div class="flex flex-wrap gap-2 text-xs text-white/70">
          <span class="inline-flex items-center gap-1 rounded-full border border-emerald-400/30 bg-emerald-400/10 px-3 py-1"><i data-lucide="shield-check" class="h-3.5 w-3.5"></i>100% 로컬 처리</span>
          <span class="inline-flex items-center gap-1 rounded-full border border-sky-400/30 bg-sky-400/10 px-3 py-1"><i data-lucide="zap" class="h-3.5 w-3.5"></i>초고속 연산</span>
          <span class="inline-flex items-center gap-1 rounded-full border border-amber-400/30 bg-amber-400/10 px-3 py-1"><i data-lucide="smartphone" class="h-3.5 w-3.5"></i>모바일·PC 반응형</span>
        </div>
      </div>
    </section>

    <!-- Summary Chips -->
    <section class="grid gap-3 sm:grid-cols-3">
      <div class="rounded-2xl glass p-4">
        <div class="text-xs text-white/50">총 파일</div>
        <div class="mt-1 text-2xl font-semibold" id="statTotalFiles">0개</div>
        <div class="text-xs text-white/40">드래그앤드롭 또는 버튼으로 추가</div>
      </div>
      <div class="rounded-2xl glass p-4">
        <div class="text-xs text-white/50">총 페이지</div>
        <div class="mt-1 text-2xl font-semibold" id="statTotalPages">0p</div>
        <div class="text-xs text-white/40">병합/분할 범위 산출에 활용</div>
      </div>
      <div class="rounded-2xl glass p-4">
        <div class="text-xs text-white/50">총 용량</div>
        <div class="mt-1 text-2xl font-semibold" id="statTotalSize">0 B</div>
        <div class="text-xs text-white/40">압축 결과와 비교하세요</div>
      </div>
    </section>

    <!-- Main Workspace -->
    <section class="grid gap-6 lg:grid-cols-[minmax(0,1.15fr)_minmax(0,1fr)]">
      <!-- File manager -->
      <div class="space-y-5">
        <div class="rounded-3xl border border-white/10 glass p-6">
          <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
            <div>
              <h2 class="text-xl font-semibold tracking-tight">PDF 자산 관리</h2>
              <p class="text-sm text-white/60">순서 정렬 · 대표 파일 선택 · 메타 정보 확인</p>
            </div>
            <div class="flex gap-2">
              <button id="btnClearFiles" class="inline-flex items-center gap-2 rounded-xl border border-white/15 px-3 py-2 text-sm text-white/70 hover:border-white/25 hover:text-white"><i data-lucide="trash-2" class="h-4 w-4"></i> 모두 지우기</button>
              <label class="inline-flex cursor-pointer items-center gap-2 rounded-xl border border-emerald-400/40 bg-emerald-400/10 px-3 py-2 text-sm font-medium text-emerald-100 hover:bg-emerald-400/20">
                <i data-lucide="upload-cloud" class="h-4 w-4"></i>
                <input id="fileInput" type="file" accept="application/pdf" multiple class="hidden" />
                파일 불러오기
              </label>
            </div>
          </div>

          <div id="dropZone" class="mt-5 flex min-h-[160px] cursor-pointer flex-col items-center justify-center rounded-2xl border border-dashed border-white/15 bg-black/20 p-6 text-center transition-all">
            <div class="flex h-12 w-12 items-center justify-center rounded-full border border-white/15 bg-white/5 text-white/70">
              <i data-lucide="files" class="h-6 w-6"></i>
            </div>
            <p class="mt-3 text-sm text-white/70"><strong>여기에 PDF를 끌어다 놓거나</strong><br/>버튼으로 여러 파일을 한 번에 추가하세요.</p>
            <p class="mt-2 text-xs text-white/40">정렬 순서대로 병합되며, 분할/압축은 선택된 대표 파일 기준으로 작동합니다.</p>
          </div>

          <ul id="fileList" class="mt-5 space-y-3" aria-live="polite"></ul>
        </div>
      </div>

      <!-- Operation panel -->
      <div class="space-y-5">
        <div class="rounded-3xl border border-white/10 glass p-6 space-y-5">
          <div class="flex items-center justify-between gap-3">
            <h2 class="text-xl font-semibold tracking-tight">작업 선택</h2>
            <span id="statusLabel" class="text-xs text-emerald-300"></span>
          </div>
          <div class="flex flex-wrap gap-2" role="tablist">
            <button data-mode-btn="merge" class="mode-btn inline-flex items-center gap-2 rounded-xl border border-sky-400/30 bg-sky-400/10 px-3 py-2 text-sm font-medium text-sky-100 hover:bg-sky-400/20" aria-selected="true"><i data-lucide="combine" class="h-4 w-4"></i> 합치기</button>
            <button data-mode-btn="split" class="mode-btn inline-flex items-center gap-2 rounded-xl border border-amber-400/30 bg-transparent px-3 py-2 text-sm font-medium text-white/70 hover:bg-amber-400/10"><i data-lucide="split-square-horizontal" class="h-4 w-4"></i> 분할</button>
            <button data-mode-btn="compress" class="mode-btn inline-flex items-center gap-2 rounded-xl border border-emerald-400/30 bg-transparent px-3 py-2 text-sm font-medium text-white/70 hover:bg-emerald-400/10"><i data-lucide="scissors" class="h-4 w-4"></i> 압축</button>
          </div>

          <!-- Merge panel -->
          <div data-mode-panel="merge" class="space-y-4">
            <div class="rounded-2xl border border-white/10 bg-white/5 p-4 text-sm text-white/70">
              파일 목록 순서대로 병합합니다. 페이지 수가 많은 경우에도 브라우저 메모리에서 안전하게 처리됩니다.
            </div>
            <button id="btnMerge" class="w-full rounded-2xl border border-sky-400/40 bg-sky-400/20 px-4 py-3 text-base font-semibold text-sky-50 hover:bg-sky-400/30 disabled:cursor-not-allowed disabled:border-white/10 disabled:bg-white/5 disabled:text-white/30">
              <span class="inline-flex items-center justify-center gap-2"><i data-lucide="download" class="h-5 w-5"></i> 병합 PDF 다운로드</span>
            </button>
            <p class="text-xs text-white/40">Tip. 순서를 바꾸려면 목록에서 위/아래 버튼을 사용하세요.</p>
          </div>

          <!-- Split panel -->
          <div data-mode-panel="split" class="hidden space-y-4">
            <div class="rounded-2xl border border-white/10 bg-white/5 p-4 text-sm text-white/70">
              대표 파일: <span id="activeName" class="font-medium text-white">선택된 PDF 없음</span><br/>
              페이지: <span id="activePages">-</span> · 용량: <span id="activeSize">-</span>
            </div>
            <div class="grid gap-3 sm:grid-cols-2">
              <label class="flex flex-col gap-1 text-sm">
                <span class="text-white/60">시작 페이지</span>
                <input id="splitStart" type="number" min="1" value="1" class="rounded-xl border border-white/10 bg-black/30 px-3 py-2 text-sm outline-none focus:border-amber-400" />
              </label>
              <label class="flex flex-col gap-1 text-sm">
                <span class="text-white/60">종료 페이지</span>
                <input id="splitEnd" type="number" min="1" value="1" class="rounded-xl border border-white/10 bg-black/30 px-3 py-2 text-sm outline-none focus:border-amber-400" />
              </label>
            </div>
            <label class="flex flex-col gap-1 text-sm">
              <span class="text-white/60">파일명 접두사</span>
              <input id="splitPrefix" type="text" class="rounded-xl border border-white/10 bg-black/30 px-3 py-2 text-sm outline-none focus:border-amber-400" placeholder="예: contract" />
            </label>
            <div class="grid gap-3 sm:grid-cols-2">
              <button id="btnSplitRange" class="rounded-2xl border border-amber-400/40 bg-amber-400/20 px-4 py-3 text-base font-semibold text-amber-50 hover:bg-amber-400/30 disabled:cursor-not-allowed disabled:border-white/10 disabled:bg-white/5 disabled:text-white/30">
                <span class="inline-flex items-center justify-center gap-2"><i data-lucide="crop" class="h-5 w-5"></i> 범위 추출</span>
              </button>
              <button id="btnSplitAll" class="rounded-2xl border border-white/15 bg-white/5 px-4 py-3 text-base font-semibold text-white hover:bg-white/10 disabled:cursor-not-allowed disabled:border-white/10 disabled:bg-white/5 disabled:text-white/30">
                <span class="inline-flex items-center justify-center gap-2"><i data-lucide="archive" class="h-5 w-5"></i> 전체 페이지 ZIP</span>
              </button>
            </div>
            <p class="text-xs text-white/40">범위를 지정하면 해당 페이지 묶음만 별도의 PDF로 추출합니다. 전체 ZIP은 페이지마다 독립된 PDF를 생성하여 압축합니다.</p>
          </div>

          <!-- Compress panel -->
          <div data-mode-panel="compress" class="hidden space-y-4">
            <div class="rounded-2xl border border-white/10 bg-white/5 p-4 text-sm text-white/70">
              대표 파일: <span id="compressActiveName" class="font-medium text-white">선택된 PDF 없음</span><br/>
              원본 용량: <span id="compressOriginalSize">-</span>
            </div>
            <fieldset class="space-y-2 text-sm text-white/80">
              <legend class="text-xs uppercase tracking-wide text-white/50">압축 등급</legend>
              <label class="flex items-center gap-2">
                <input type="radio" name="compressMode" value="lossless" class="accent-emerald-400" checked /> 무손실 (구조 최적화)
              </label>
              <label class="flex items-center gap-2">
                <input type="radio" name="compressMode" value="balanced" class="accent-emerald-400" /> 표준 (텍스트/이미지 균형)
              </label>
              <label class="flex items-center gap-2">
                <input type="radio" name="compressMode" value="max" class="accent-emerald-400" /> 최고압축 (이미지 품질 우선 감소)
              </label>
            </fieldset>
            <div class="rounded-2xl border border-white/10 bg-black/30 p-4 text-xs text-white/50">
              표준/최고압축은 각 페이지를 JPEG 기반으로 재구성하여 용량을 줄입니다. 텍스트 검색이 어려울 수 있으니 문서 보존본은 무손실 모드로 별도 보관하세요.
            </div>
            <button id="btnCompress" class="w-full rounded-2xl border border-emerald-400/40 bg-emerald-400/20 px-4 py-3 text-base font-semibold text-emerald-50 hover:bg-emerald-400/30 disabled:cursor-not-allowed disabled:border-white/10 disabled:bg-white/5 disabled:text-white/30">
              <span class="inline-flex items-center justify-center gap-2"><i data-lucide="download" class="h-5 w-5"></i> 압축 PDF 다운로드</span>
            </button>
          </div>
        </div>

        <div class="rounded-3xl border border-white/10 glass p-6">
          <div class="flex items-center gap-2 text-sm font-medium text-white/70">
            <i data-lucide="activity" class="h-4 w-4 text-emerald-300"></i>
            실시간 진행 & 로그
          </div>
          <div id="busyIndicator" class="mt-3 hidden items-center gap-2 rounded-xl border border-white/10 bg-black/40 px-3 py-2 text-xs text-white/70">
            <svg class="h-4 w-4 animate-spin text-emerald-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 12a9 9 0 1 1-9-9" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <span id="busyMessage">작업 중...</span>
          </div>
          <ul id="logList" class="mt-4 space-y-2 text-sm text-white/70" aria-live="polite"></ul>
        </div>
      </div>
    </section>

    <!-- Help & Tips -->
    <section class="grid gap-6 lg:grid-cols-2">
      <div class="rounded-3xl border border-white/10 glass p-6">
        <div class="flex items-center gap-2 text-sm font-semibold text-white/80">
          <i data-lucide="lightbulb" class="h-4 w-4 text-yellow-300"></i>
          사용 (도움말 & 팁)
        </div>
        <ul class="mt-4 space-y-2 text-sm text-white/70 list-disc pl-5">
          <li>병합 전 <strong>파일명을 정리</strong>해두면 결과 정렬이 더 명확해집니다.</li>
          <li><strong>대표 파일</strong>을 선택하면 분할·압축 대상이 즉시 갱신됩니다.</li>
          <li>용량이 큰 이미지 PDF는 <strong>최고압축</strong>으로 한 번 더 저장하면 메일 첨부 기준(예: 20MB)을 맞추기 쉽습니다.</li>
          <li>보존이 필요한 문서는 무손실 버전도 함께 내려받아 두세요.</li>
          <li>로그 패널은 최신 10개 기록만 유지하므로 필요하면 즉시 확인하고 저장하세요.</li>
        </ul>
      </div>
      <div class="rounded-3xl border border-white/10 glass p-6">
        <div class="flex items-center gap-2 text-sm font-semibold text-white/80">
          <i data-lucide="help-circle" class="h-4 w-4 text-sky-300"></i>
          사용설명서 & FAQ
        </div>
        <ol class="mt-4 space-y-2 text-sm text-white/70 list-decimal pl-5">
          <li>PDF를 드래그하거나 <strong>파일 불러오기</strong> 버튼으로 업로드합니다.</li>
          <li>분할·압축에 사용할 파일은 목록에서 <strong>선택</strong> 버튼으로 대표 파일로 지정합니다.</li>
          <li>상단 탭에서 <strong>합치기 / 분할 / 압축</strong> 중 원하는 기능을 고릅니다.</li>
          <li>필요한 옵션(페이지 범위, 압축 등급 등)을 조정하고 <strong>실행 버튼</strong>을 누릅니다.</li>
          <li>결과 파일을 내려받아 메일 첨부 또는 보관용으로 활용합니다.</li>
        </ol>
        <div class="mt-4 rounded-2xl border border-white/10 bg-black/30 p-4 text-xs text-white/55 space-y-2">
          <p><strong>Q.</strong> 대표 파일은 어디에 쓰이나요?<br /><strong>A.</strong> 분할·압축 기능은 대표 파일 하나를 기준으로 작동합니다. 목록에서 선택 버튼을 눌러 지정하세요.</p>
          <p><strong>Q.</strong> 암호화된 PDF도 처리할 수 있나요?<br /><strong>A.</strong> 현재 버전은 암호가 걸린 PDF는 지원하지 않습니다. 잠금을 해제한 뒤 이용해주세요.</p>
        </div>
      </div>
    </section>
  </main>

  <!-- 공통 푸터 -->
  <div data-include="/partials/footer.html"></div>

  <!-- Layout include & tool script -->
  <script defer src="/inject-layout.js?v=8"></script>
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const { PDFDocument } = window.PDFLib || {};
    const JSZipCtor = window.JSZip;
    const pdfjsLib = window['pdfjsLib'];
    if (pdfjsLib) {
      pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.worker.min.js';
    }

    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const fileList = document.getElementById('fileList');
    const statTotalFiles = document.getElementById('statTotalFiles');
    const statTotalPages = document.getElementById('statTotalPages');
    const statTotalSize = document.getElementById('statTotalSize');
    const btnClearFiles = document.getElementById('btnClearFiles');
    const statusLabel = document.getElementById('statusLabel');
    const busyIndicator = document.getElementById('busyIndicator');
    const busyMessage = document.getElementById('busyMessage');
    const logList = document.getElementById('logList');

    const btnMerge = document.getElementById('btnMerge');
    const btnSplitRange = document.getElementById('btnSplitRange');
    const btnSplitAll = document.getElementById('btnSplitAll');
    const btnCompress = document.getElementById('btnCompress');

    const splitStart = document.getElementById('splitStart');
    const splitEnd = document.getElementById('splitEnd');
    const splitPrefix = document.getElementById('splitPrefix');
    const activeName = document.getElementById('activeName');
    const activePages = document.getElementById('activePages');
    const activeSize = document.getElementById('activeSize');
    const compressActiveName = document.getElementById('compressActiveName');
    const compressOriginalSize = document.getElementById('compressOriginalSize');

    const state = {
      files: [],
      activeIndex: -1,
      mode: 'merge',
      busy: false,
      logs: [],
      lastActiveSignature: null
    };

    const compressPresets = {
      lossless: { label: '무손실', description: 'PDF 구조 최적화', mode: 'lossless' },
      balanced: { label: '표준', scale: 1.2, quality: 0.82 },
      max: { label: '최고압축', scale: 1.0, quality: 0.68 }
    };

    function formatBytes(bytes) {
      if (!Number.isFinite(bytes) || bytes <= 0) return '0 B';
      const units = ['B','KB','MB','GB'];
      const exponent = Math.min(Math.floor(Math.log(bytes) / Math.log(1024)), units.length - 1);
      return `${(bytes / Math.pow(1024, exponent)).toFixed(exponent === 0 ? 0 : 1)} ${units[exponent]}`;
    }

    function appendLog(message, level = 'info') {
      const time = new Date();
      state.logs.unshift({ message, level, time });
      if (state.logs.length > 10) state.logs.length = 10;
      renderLogs();
    }

    function renderLogs() {
      logList.innerHTML = '';
      state.logs.forEach(({ message, level, time }) => {
        const li = document.createElement('li');
        li.className = `rounded-xl border px-3 py-2 text-xs sm:text-sm ${level === 'error' ? 'border-rose-400/40 bg-rose-400/10 text-rose-100' : level === 'success' ? 'border-emerald-400/35 bg-emerald-400/10 text-emerald-50' : 'border-white/10 bg-white/5 text-white/70'}`;
        li.textContent = `[${time.toLocaleTimeString()}] ${message}`;
        logList.appendChild(li);
      });
    }

    function sanitizeFilename(name) {
      return name.replace(/[\\/:*?"<>|]+/g, '_');
    }

    function baseName(name) {
      return name.replace(/\.pdf$/i, '');
    }

    function getActiveFile() {
      if (state.activeIndex < 0) return null;
      return state.files[state.activeIndex] || null;
    }

    function setBusy(isBusy, message = '') {
      state.busy = isBusy;
      if (isBusy) {
        busyIndicator.classList.remove('hidden');
        busyMessage.textContent = message || '작업 중...';
        statusLabel.textContent = message;
      } else {
        busyIndicator.classList.add('hidden');
        statusLabel.textContent = '';
      }
      updateButtons();
    }

    function setMode(mode) {
      state.mode = mode;
      document.querySelectorAll('[data-mode-panel]').forEach(panel => {
        panel.classList.toggle('hidden', panel.getAttribute('data-mode-panel') !== mode);
      });
      document.querySelectorAll('[data-mode-btn]').forEach(btn => {
        const active = btn.getAttribute('data-mode-btn') === mode;
        btn.setAttribute('aria-selected', active ? 'true' : 'false');
        btn.classList.toggle('bg-sky-400/10', active && mode === 'merge');
        btn.classList.toggle('border-sky-400/30', active && mode === 'merge');
        btn.classList.toggle('text-sky-100', active && mode === 'merge');

        btn.classList.toggle('bg-amber-400/10', active && mode === 'split');
        btn.classList.toggle('border-amber-400/30', active && mode === 'split');
        btn.classList.toggle('text-amber-100', active && mode === 'split');

        btn.classList.toggle('bg-emerald-400/10', active && mode === 'compress');
        btn.classList.toggle('border-emerald-400/30', active && mode === 'compress');
        btn.classList.toggle('text-emerald-100', active && mode === 'compress');

        if (!active) {
          btn.classList.remove('bg-sky-400/10','border-sky-400/30','text-sky-100','bg-amber-400/10','border-amber-400/30','text-amber-100','bg-emerald-400/10','border-emerald-400/30','text-emerald-100');
          btn.classList.add('bg-transparent','text-white/70');
        } else {
          btn.classList.remove('bg-transparent','text-white/70');
        }
      });
      updateButtons();
    }

    async function handleFiles(fileListLike) {
      const files = Array.from(fileListLike || []);
      if (!files.length) return;
      if (!PDFDocument) {
        appendLog('PDF 라이브러리를 불러오지 못했습니다. 잠시 후 다시 시도해주세요.', 'error');
        return;
      }
      setBusy(true, 'PDF 분석 중...');
      for (const file of files) {
        if (!file.name.toLowerCase().endsWith('.pdf')) {
          appendLog(`무시됨: ${file.name} — PDF 파일만 지원합니다.`, 'error');
          continue;
        }
        try {
          const arrayBuffer = await file.arrayBuffer();
          const bytes = new Uint8Array(arrayBuffer);
          const pdfDoc = await PDFDocument.load(bytes, { updateMetadata: false });
          const pageCount = pdfDoc.getPageCount();
          const entry = {
            name: file.name,
            size: file.size,
            bytes,
            pageCount,
            addedAt: Date.now()
          };
          state.files.push(entry);
          if (state.activeIndex === -1) {
            state.activeIndex = 0;
          }
          appendLog(`추가됨: ${file.name} (${pageCount}p · ${formatBytes(file.size)})`, 'success');
        } catch (err) {
          console.error(err);
          appendLog(`불러오기 실패: ${file.name}`, 'error');
        }
      }
      renderAll();
      setBusy(false);
    }

    function renderAll() {
      renderFiles();
      renderSummary();
      renderActiveInfo();
      if (window.lucide?.createIcons) window.lucide.createIcons();
    }

    function renderSummary() {
      const totalFiles = state.files.length;
      const totalPages = state.files.reduce((sum, file) => sum + (file.pageCount || 0), 0);
      const totalBytes = state.files.reduce((sum, file) => sum + (file.size || 0), 0);
      statTotalFiles.textContent = `${totalFiles}개`;
      statTotalPages.textContent = `${totalPages}p`;
      statTotalSize.textContent = formatBytes(totalBytes);
    }

    function renderActiveInfo() {
      const active = getActiveFile();
      if (active) {
        const signature = `${active.name}-${active.size}-${active.pageCount}`;
        const isChanged = state.lastActiveSignature !== signature;
        activeName.textContent = active.name;
        activePages.textContent = `${active.pageCount} 페이지`;
        activeSize.textContent = formatBytes(active.size);
        compressActiveName.textContent = active.name;
        compressOriginalSize.textContent = formatBytes(active.size);
        const maxPage = Math.max(active.pageCount, 1);
        splitStart.max = maxPage;
        splitEnd.max = maxPage;
        if (isChanged) {
          splitStart.value = 1;
          splitEnd.value = active.pageCount;
          splitPrefix.value = sanitizeFilename(baseName(active.name));
        } else {
          if (Number(splitStart.value) < 1) splitStart.value = 1;
          if (Number(splitStart.value) > maxPage) splitStart.value = maxPage;
          if (Number(splitEnd.value) < 1) splitEnd.value = 1;
          if (Number(splitEnd.value) > maxPage) splitEnd.value = maxPage;
        }
        state.lastActiveSignature = signature;
      } else {
        activeName.textContent = '선택된 PDF 없음';
        activePages.textContent = '-';
        activeSize.textContent = '-';
        compressActiveName.textContent = '선택된 PDF 없음';
        compressOriginalSize.textContent = '-';
        state.lastActiveSignature = null;
      }
      updateButtons();
    }

    function renderFiles() {
      fileList.innerHTML = '';
      if (!state.files.length) {
        const empty = document.createElement('li');
        empty.className = 'rounded-2xl border border-dashed border-white/10 bg-black/20 px-4 py-6 text-center text-sm text-white/50';
        empty.textContent = '추가된 PDF가 없습니다. 파일을 업로드하면 여기에서 순서를 조정할 수 있습니다.';
        fileList.appendChild(empty);
        return;
      }
      state.files.forEach((file, index) => {
        const li = document.createElement('li');
        const isActive = index === state.activeIndex;
        li.dataset.index = index;
        li.className = `rounded-2xl border px-4 py-3 transition-colors ${isActive ? 'border-emerald-400/50 bg-emerald-400/10' : 'border-white/10 bg-black/30 hover:border-white/20'}`;
        li.innerHTML = `
          <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
            <div class="min-w-0">
              <div class="truncate text-sm font-medium">${file.name}</div>
              <div class="text-xs text-white/50">${file.pageCount}p · ${formatBytes(file.size)}</div>
            </div>
            <div class="flex flex-wrap items-center gap-2 text-xs">
              <button data-action="activate" class="inline-flex items-center gap-1 rounded-lg border ${isActive ? 'border-emerald-400/60 bg-emerald-400/20 text-emerald-50' : 'border-white/15 bg-white/5 text-white/70 hover:border-emerald-400/40 hover:text-emerald-100'} px-2.5 py-1">${isActive ? '<i data-lucide="check" class="h-3.5 w-3.5"></i> 대표' : '<i data-lucide="target" class="h-3.5 w-3.5"></i> 선택'}</button>
              <button data-action="up" class="inline-flex items-center gap-1 rounded-lg border border-white/15 bg-white/5 px-2.5 py-1 text-white/70 hover:border-white/30"><i data-lucide="arrow-up" class="h-3.5 w-3.5"></i></button>
              <button data-action="down" class="inline-flex items-center gap-1 rounded-lg border border-white/15 bg-white/5 px-2.5 py-1 text-white/70 hover:border-white/30"><i data-lucide="arrow-down" class="h-3.5 w-3.5"></i></button>
              <button data-action="remove" class="inline-flex items-center gap-1 rounded-lg border border-rose-400/30 bg-rose-400/10 px-2.5 py-1 text-rose-100 hover:bg-rose-400/20"><i data-lucide="trash" class="h-3.5 w-3.5"></i></button>
            </div>
          </div>
        `;
        fileList.appendChild(li);
      });
    }

    function updateButtons() {
      const active = getActiveFile();
      const disabled = state.busy;
      btnMerge.disabled = disabled || state.files.length < 2;
      btnSplitRange.disabled = disabled || !active;
      btnSplitAll.disabled = disabled || !active;
      btnCompress.disabled = disabled || !active;
      btnClearFiles.disabled = disabled || state.files.length === 0;
    }

    async function mergePdfs() {
      if (state.busy) return;
      if (state.files.length < 2) {
        appendLog('병합하려면 두 개 이상의 PDF가 필요합니다.', 'error');
        return;
      }
      setBusy(true, '병합 중...');
      try {
        const mergedPdf = await PDFDocument.create();
        let totalPages = 0;
        for (const file of state.files) {
          const doc = await PDFDocument.load(file.bytes);
          const copied = await mergedPdf.copyPages(doc, doc.getPageIndices());
          copied.forEach(page => mergedPdf.addPage(page));
          totalPages += copied.length;
        }
        const resultBytes = await mergedPdf.save({ useObjectStreams: true });
        const filename = `merged-${Date.now()}.pdf`;
        downloadBytes(resultBytes, filename);
        appendLog(`병합 완료: ${filename} (${totalPages}p)`, 'success');
      } catch (err) {
        console.error(err);
        appendLog('병합 중 오류가 발생했습니다.', 'error');
      } finally {
        setBusy(false);
      }
    }

    async function splitRange() {
      if (state.busy) return;
      const active = getActiveFile();
      if (!active) {
        appendLog('분할할 대표 PDF를 선택해주세요.', 'error');
        return;
      }
      const start = Number(splitStart.value);
      const end = Number(splitEnd.value);
      if (!Number.isInteger(start) || !Number.isInteger(end) || start < 1 || end < start || end > active.pageCount) {
        appendLog('유효한 페이지 범위를 입력해주세요.', 'error');
        return;
      }
      setBusy(true, '분할 중...');
      try {
        const src = await PDFDocument.load(active.bytes);
        const subset = await PDFDocument.create();
        const indices = [];
        for (let i = start - 1; i < end; i++) indices.push(i);
        const pages = await subset.copyPages(src, indices);
        pages.forEach(page => subset.addPage(page));
        const resultBytes = await subset.save({ useObjectStreams: true });
        const prefix = splitPrefix.value ? sanitizeFilename(splitPrefix.value) : sanitizeFilename(baseName(active.name));
        const filename = `${prefix}-p${start}-${end}.pdf`;
        downloadBytes(resultBytes, filename);
        appendLog(`분할 완료: ${filename} (${pages.length}p)`, 'success');
      } catch (err) {
        console.error(err);
        appendLog('분할 중 오류가 발생했습니다.', 'error');
      } finally {
        setBusy(false);
      }
    }

    async function splitAllPages() {
      if (state.busy) return;
      const active = getActiveFile();
      if (!active) {
        appendLog('분할할 대표 PDF를 선택해주세요.', 'error');
        return;
      }
      if (!JSZipCtor) {
        appendLog('ZIP 라이브러리를 불러오지 못했습니다.', 'error');
        return;
      }
      setBusy(true, '페이지별 추출 중...');
      try {
        const zip = new JSZipCtor();
        const src = await PDFDocument.load(active.bytes);
        const total = src.getPageCount();
        for (let i = 0; i < total; i++) {
          const single = await PDFDocument.create();
          const [page] = await single.copyPages(src, [i]);
          single.addPage(page);
          const singleBytes = await single.save({ useObjectStreams: true });
          const prefix = splitPrefix.value ? sanitizeFilename(splitPrefix.value) : sanitizeFilename(baseName(active.name));
          const fileName = `${prefix}-p${i + 1}.pdf`;
          zip.file(fileName, singleBytes);
        }
        const blob = await zip.generateAsync({ type: 'blob' });
        const zipName = `${sanitizeFilename(baseName(active.name))}-split.zip`;
        downloadBlob(blob, zipName);
        appendLog(`전체 페이지 ZIP 완료: ${zipName} (${src.getPageCount()}개)`, 'success');
      } catch (err) {
        console.error(err);
        appendLog('전체 페이지 분할 중 오류가 발생했습니다.', 'error');
      } finally {
        setBusy(false);
      }
    }

    async function compressPdf() {
      if (state.busy) return;
      const active = getActiveFile();
      if (!active) {
        appendLog('압축할 대표 PDF를 선택해주세요.', 'error');
        return;
      }
      const mode = document.querySelector('input[name="compressMode"]:checked')?.value || 'lossless';
      if (!PDFDocument) {
        appendLog('PDF 라이브러리를 불러오지 못했습니다.', 'error');
        return;
      }
      setBusy(true, '압축 중...');
      const originalSize = active.size;
      try {
        let resultBytes;
        if (mode === 'lossless') {
          const doc = await PDFDocument.load(active.bytes, { updateMetadata: false });
          resultBytes = await doc.save({ useObjectStreams: true });
        } else {
          if (!pdfjsLib) {
            appendLog('압축 모듈(pdf.js)을 불러오지 못했습니다.', 'error');
            return;
          }
          const preset = compressPresets[mode];
          const loadingTask = pdfjsLib.getDocument({ data: active.bytes });
          const pdf = await loadingTask.promise;
          const out = await PDFDocument.create();
          for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
            const page = await pdf.getPage(pageNum);
            const viewport = page.getViewport({ scale: preset.scale });
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d', { willReadFrequently: false });
            canvas.width = Math.round(viewport.width);
            canvas.height = Math.round(viewport.height);
            await page.render({ canvasContext: context, viewport }).promise;
            const dataUrl = canvas.toDataURL('image/jpeg', preset.quality);
            const response = await fetch(dataUrl);
            const imageBytes = new Uint8Array(await response.arrayBuffer());
            const embedded = await out.embedJpg(imageBytes);
            const pdfPage = out.addPage([viewport.width, viewport.height]);
            pdfPage.drawImage(embedded, {
              x: 0,
              y: 0,
              width: viewport.width,
              height: viewport.height
            });
            canvas.width = 0;
            canvas.height = 0;
          }
          await loadingTask.destroy();
          resultBytes = await out.save({ useObjectStreams: true });
        }
        if (!resultBytes) throw new Error('압축 결과 없음');
        const newSize = resultBytes.byteLength || resultBytes.length;
        const diff = originalSize - newSize;
        const ratio = originalSize > 0 ? ((newSize / originalSize) * 100).toFixed(1) : '0.0';
        const fileName = `${sanitizeFilename(baseName(active.name))}-${mode}-compressed.pdf`;
        downloadBytes(resultBytes, fileName);
        appendLog(`압축 완료: ${fileName} → ${formatBytes(newSize)} (${ratio}% of original, ${diff > 0 ? '-' : '+'}${formatBytes(Math.abs(diff))})`, 'success');
      } catch (err) {
        console.error(err);
        appendLog('압축 중 오류가 발생했습니다.', 'error');
      } finally {
        setBusy(false);
      }
    }

    function downloadBytes(bytes, filename) {
      const blob = bytes instanceof Blob ? bytes : new Blob([bytes], { type: 'application/pdf' });
      downloadBlob(blob, filename);
    }

    function downloadBlob(blob, filename) {
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      setTimeout(() => {
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }, 0);
    }

    dropZone.addEventListener('click', () => fileInput.click());
    dropZone.addEventListener('dragover', (event) => {
      event.preventDefault();
      dropZone.classList.add('drop-active');
    });
    dropZone.addEventListener('dragleave', () => {
      dropZone.classList.remove('drop-active');
    });
    dropZone.addEventListener('drop', (event) => {
      event.preventDefault();
      dropZone.classList.remove('drop-active');
      handleFiles(event.dataTransfer?.files);
    });

    fileInput.addEventListener('change', (event) => {
      handleFiles(event.target.files);
      fileInput.value = '';
    });

    btnClearFiles.addEventListener('click', () => {
      if (state.busy) return;
      state.files = [];
      state.activeIndex = -1;
      state.lastActiveSignature = null;
      renderAll();
      appendLog('모든 PDF가 제거되었습니다.', 'info');
    });

    fileList.addEventListener('click', (event) => {
      const target = event.target.closest('[data-action]');
      if (!target || state.busy) return;
      const item = event.target.closest('li');
      if (!item) return;
      const index = Number(item.dataset.index);
      if (Number.isNaN(index)) return;
      switch (target.dataset.action) {
        case 'activate':
          state.activeIndex = index;
          renderAll();
          appendLog(`${state.files[index].name} 파일을 대표로 지정했습니다.`, 'info');
          break;
        case 'up':
          if (index === 0) return;
          const tempUp = state.files[index - 1];
          state.files[index - 1] = state.files[index];
          state.files[index] = tempUp;
          if (state.activeIndex === index) state.activeIndex = index - 1;
          else if (state.activeIndex === index - 1) state.activeIndex = index;
          renderAll();
          break;
        case 'down':
          if (index >= state.files.length - 1) return;
          const tempDown = state.files[index + 1];
          state.files[index + 1] = state.files[index];
          state.files[index] = tempDown;
          if (state.activeIndex === index) state.activeIndex = index + 1;
          else if (state.activeIndex === index + 1) state.activeIndex = index;
          renderAll();
          break;
        case 'remove':
          const removed = state.files.splice(index, 1)[0];
          if (state.activeIndex === index) {
            state.activeIndex = state.files.length ? Math.max(0, index - 1) : -1;
          } else if (state.activeIndex > index) {
            state.activeIndex -= 1;
          }
          renderAll();
          appendLog(`삭제됨: ${removed.name}`, 'info');
          break;
      }
    });

    document.querySelectorAll('[data-mode-btn]').forEach(btn => {
      btn.addEventListener('click', () => {
        if (state.busy) return;
        setMode(btn.getAttribute('data-mode-btn'));
      });
    });

    btnMerge.addEventListener('click', mergePdfs);
    btnSplitRange.addEventListener('click', splitRange);
    btnSplitAll.addEventListener('click', splitAllPages);
    btnCompress.addEventListener('click', compressPdf);

    setMode(state.mode);
    renderAll();
  });
  </script>
</body>
</html>
