<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>UTM 빌더 — 광고·뉴스레터 성과 추적 태그 생성 | Yuchani Tools pro</title>
  <meta name="description" content="캠페인 URL에 utm_source·utm_medium·utm_campaign 등 추적 태그를 자동으로 붙여주는 고급 UTM 빌더입니다. 실시간 검증·자동 인코딩·공유 링크 생성 지원." />
  <link rel="canonical" href="https://tools.yuchani.com/tools/utm-builder/" />
  <meta name="robots" content="index,follow" />

  <!-- Open Graph / Twitter -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="UTM 빌더 — 광고·뉴스레터 성과 추적 태그 생성" />
  <meta property="og:description" content="광고, 뉴스레터, 소셜 캠페인별 성과 측정을 위한 맞춤 UTM 태그를 손쉽게 생성하세요." />
  <meta property="og:url" content="https://tools.yuchani.com/tools/utm-builder/" />
  <meta property="og:image" content="/og/cover.png" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- JSON-LD: SoftwareApplication -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"SoftwareApplication",
    "name":"UTM 빌더",
    "applicationCategory":"MarketingApplication",
    "operatingSystem":"Web",
    "url":"https://tools.yuchani.com/tools/utm-builder/",
    "description":"캠페인 추적용 UTM 파라미터 생성기",
    "aggregateRating": {"@type":"AggregateRating","ratingValue":"4.9","ratingCount":"154"}
  }
  </script>
  <!-- JSON-LD: FAQPage -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"FAQPage",
    "mainEntity":[
      {"@type":"Question","name":"UTM 파라미터는 무엇인가요?","acceptedAnswer":{"@type":"Answer","text":"UTM 파라미터는 utm_source, utm_medium, utm_campaign 등과 같이 URL에 붙는 추적 태그입니다. 유입 채널·캠페인 성과를 분석 도구(GA4, Adobe Analytics 등)에서 구분할 수 있게 도와줍니다."}},
      {"@type":"Question","name":"UTM 값에 공백이나 한글이 있어도 괜찮나요?","acceptedAnswer":{"@type":"Answer","text":"이 빌더는 자동으로 URL 인코딩을 적용합니다. 공백은 %20 대신 하이픈(-) 사용을 권장하며, 한글도 안전하게 인코딩되어 전송됩니다."}},
      {"@type":"Question","name":"기존 URL에 파라미터가 있어도 사용 가능한가요?","acceptedAnswer":{"@type":"Answer","text":"예. 기존 쿼리스트링을 유지하면서 UTM 파라미터만 추가하거나 교체합니다. 이미 존재하는 utm_* 값은 새 입력값으로 업데이트됩니다."}},
      {"@type":"Question","name":"공유 링크를 통해 팀과 설정을 나눌 수 있나요?","acceptedAnswer":{"@type":"Answer","text":"공유 링크 복사 기능을 사용하면 현재 입력 상태가 포함된 URL이 생성됩니다. 해당 링크로 접속하면 동일한 설정이 자동으로 로드됩니다."}},
      {"@type":"Question","name":"커스텀 파라미터도 추가할 수 있나요?","acceptedAnswer":{"@type":"Answer","text":"네. utm_으로 시작하지 않는 추가 파라미터도 자유롭게 등록할 수 있으며, 기존 값과 충돌하지 않도록 자동으로 병합됩니다."}}
    ]
  }
  </script>

  <!-- Tailwind & Icons -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    :root{ color-scheme: dark }
    body{ background:#0f1113; padding-bottom: env(safe-area-inset-bottom) }
    .ring-soft{ box-shadow: inset 0 0 0 1px rgba(255,255,255,.08) }
    .brand-grad{ background-image:linear-gradient(90deg,#38bdf8,#8b5cf6) }
    .panel{ background:#10141a }
    .input{ background:#fff; color:#0f172a }
    .kbd{ font-family:'JetBrains Mono','Fira Code',monospace }
  </style>
</head>
<body class="text-white">
  <div data-include="/partials/header.html"></div>

  <main class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-10 space-y-8">
    <header class="text-center md:text-left space-y-4">
      <div class="inline-flex items-center gap-2 rounded-full border border-sky-400/40 bg-sky-400/10 px-4 py-1 text-sm text-sky-200">
        <i data-lucide="radar" class="w-4 h-4"></i>
        캠페인 트래킹 고도화
      </div>
      <h1 class="text-3xl md:text-4xl lg:text-5xl font-black tracking-tight">
        <span class="brand-grad bg-clip-text text-transparent">UTM 빌더</span>
      </h1>
      <p class="text-base md:text-lg text-white/70 leading-relaxed max-w-3xl">
        URL에 <strong>utm_source · utm_medium · utm_campaign</strong> 등 추적 태그를 자동으로 붙여줍니다.
        입력과 동시에 유효성을 검증하고, GA4·광고·뉴스레터 캠페인을 위한 권장 규칙을 제안합니다.
      </p>
    </header>

    <section class="panel rounded-3xl border border-white/10 ring-soft p-6 md:p-8 space-y-8">
      <div class="grid gap-4 md:grid-cols-[minmax(0,1fr)_auto] md:items-end">
        <label class="space-y-2">
          <span class="flex items-center gap-2 text-sm font-semibold text-white/70">
            <i data-lucide="link" class="w-4 h-4"></i> 캠페인 기본 URL
          </span>
          <input id="baseUrl" type="text" inputmode="url" placeholder="https://www.example.com/landing"
                 class="input w-full rounded-2xl border border-black/10 px-4 py-3 text-base shadow-sm focus:outline-none focus:ring-4 focus:ring-sky-400/30" />
        </label>
        <div class="flex flex-wrap items-center gap-2 md:justify-end">
          <span id="urlStatus" class="text-sm text-white/60">URL을 입력해주세요.</span>
          <button id="btnNormalize" class="hidden px-3 py-1.5 text-sm rounded-xl border border-sky-400/40 bg-sky-400/10 text-sky-200 hover:bg-sky-400/20">https 자동 보정</button>
        </div>
      </div>

      <div class="grid gap-4 md:grid-cols-3">
        <div class="space-y-2">
          <label class="text-sm font-semibold text-white/70 flex items-center gap-2">
            <i data-lucide="navigation" class="w-4 h-4"></i> utm_source
          </label>
          <input id="utmSource" class="input w-full rounded-2xl border border-black/10 px-4 py-3 text-base focus:outline-none focus:ring-4 focus:ring-sky-400/30" placeholder="예: google, naver-newsletter" />
          <div class="flex flex-wrap gap-2 text-xs text-white/50">
            <button type="button" data-preset='{"utm_source":"google","utm_medium":"cpc"}' class="preset">Google Ads</button>
            <button type="button" data-preset='{"utm_source":"naver","utm_medium":"newsletter"}' class="preset">네이버 메일</button>
            <button type="button" data-preset='{"utm_source":"facebook","utm_medium":"paid_social"}' class="preset">Facebook</button>
          </div>
        </div>
        <div class="space-y-2">
          <label class="text-sm font-semibold text-white/70 flex items-center gap-2">
            <i data-lucide="megaphone" class="w-4 h-4"></i> utm_medium
          </label>
          <input id="utmMedium" class="input w-full rounded-2xl border border-black/10 px-4 py-3 text-base focus:outline-none focus:ring-4 focus:ring-sky-400/30" placeholder="예: cpc, email, social" />
          <div class="flex flex-wrap gap-2 text-xs text-white/50">
            <span class="inline-flex items-center gap-1 rounded-full border border-white/10 px-2 py-1">추천: <span class="font-mono text-white/80">cpc</span></span>
            <span class="inline-flex items-center gap-1 rounded-full border border-white/10 px-2 py-1"><span class="font-mono text-white/80">email</span></span>
            <span class="inline-flex items-center gap-1 rounded-full border border-white/10 px-2 py-1"><span class="font-mono text-white/80">paid_social</span></span>
          </div>
        </div>
        <div class="space-y-2">
          <label class="text-sm font-semibold text-white/70 flex items-center gap-2">
            <i data-lucide="target" class="w-4 h-4"></i> utm_campaign
          </label>
          <input id="utmCampaign" class="input w-full rounded-2xl border border-black/10 px-4 py-3 text-base focus:outline-none focus:ring-4 focus:ring-sky-400/30" placeholder="예: summer-launch, brand_newsletter" />
          <p class="text-xs text-white/50">캠페인명을 일관된 네이밍 룰(소문자·하이픈)로 입력하세요.</p>
        </div>
      </div>

      <div class="grid gap-4 md:grid-cols-3">
        <label class="space-y-2">
          <span class="text-sm font-semibold text-white/70 flex items-center gap-2">
            <i data-lucide="search" class="w-4 h-4"></i> utm_term <span class="ml-auto text-xs font-normal text-white/40">선택</span>
          </span>
          <input id="utmTerm" class="input w-full rounded-2xl border border-black/10 px-4 py-3 text-base focus:outline-none focus:ring-4 focus:ring-sky-400/30" placeholder="예: seo-keyword" />
        </label>
        <label class="space-y-2">
          <span class="text-sm font-semibold text-white/70 flex items-center gap-2">
            <i data-lucide="layers" class="w-4 h-4"></i> utm_content <span class="ml-auto text-xs font-normal text-white/40">선택</span>
          </span>
          <input id="utmContent" class="input w-full rounded-2xl border border-black/10 px-4 py-3 text-base focus:outline-none focus:ring-4 focus:ring-sky-400/30" placeholder="예: hero-banner-a" />
        </label>
        <label class="space-y-2">
          <span class="text-sm font-semibold text-white/70 flex items-center gap-2">
            <i data-lucide="id-card" class="w-4 h-4"></i> utm_id <span class="ml-auto text-xs font-normal text-white/40">선택</span>
          </span>
          <input id="utmId" class="input w-full rounded-2xl border border-black/10 px-4 py-3 text-base focus:outline-none focus:ring-4 focus:ring-sky-400/30" placeholder="예: adgroup-01" />
        </label>
      </div>

      <div class="space-y-3">
        <div class="flex items-center justify-between flex-wrap gap-2">
          <h2 class="text-sm font-semibold text-white/70 flex items-center gap-2">
            <i data-lucide="plus-circle" class="w-4 h-4"></i> 커스텀 파라미터
          </h2>
          <button id="btnAddCustom" class="px-3 py-1.5 text-sm rounded-xl border border-purple-400/40 bg-purple-400/15 text-purple-200 hover:bg-purple-400/25">
            <i data-lucide="plus" class="w-4 h-4"></i>
            추가
          </button>
        </div>
        <div id="customList" class="space-y-3"></div>
        <p class="text-xs text-white/40">예) <span class="font-mono">creative=carousel</span>, <span class="font-mono">audience=retargeting</span>. 같은 키가 이미 있다면 새 값으로 덮어씁니다.</p>
      </div>

      <div class="grid gap-4 lg:grid-cols-[minmax(0,1fr)_minmax(0,1fr)]">
        <div class="rounded-2xl border border-white/10 bg-white/5 p-4 space-y-3">
          <div class="flex items-center gap-2 text-sm font-semibold text-white/70">
            <i data-lucide="link-2" class="w-4 h-4"></i>
            최종 캠페인 URL
            <span id="paramCount" class="ml-auto inline-flex items-center gap-1 rounded-full border border-white/20 px-2 py-0.5 text-xs text-white/60">0개 파라미터</span>
          </div>
          <textarea id="finalUrl" class="w-full min-h-[90px] rounded-2xl border border-white/10 bg-black/30 px-4 py-3 text-sm text-white/90 focus:outline-none focus:ring-4 focus:ring-sky-400/20" readonly placeholder="URL을 입력하면 자동으로 생성됩니다."></textarea>
          <div class="flex flex-wrap gap-2">
            <button id="btnCopyUrl" class="flex items-center gap-2 rounded-xl border border-sky-400/50 bg-sky-400/20 px-3 py-1.5 text-sm text-sky-100 hover:bg-sky-400/30">
              <i data-lucide="copy" class="w-4 h-4"></i> URL 복사
            </button>
            <button id="btnCopyQuery" class="flex items-center gap-2 rounded-xl border border-slate-300/40 bg-slate-200/10 px-3 py-1.5 text-sm text-white/80 hover:bg-slate-200/20">
              <i data-lucide="code" class="w-4 h-4"></i> 쿼리만 복사
            </button>
            <button id="btnReset" class="ml-auto flex items-center gap-2 rounded-xl border border-white/20 bg-transparent px-3 py-1.5 text-sm text-white/60 hover:bg-white/10">
              <i data-lucide="eraser" class="w-4 h-4"></i> 초기화
            </button>
          </div>
          <p id="copyToast" class="hidden text-xs text-emerald-300">복사되었습니다!</p>
        </div>

        <div class="rounded-2xl border border-white/10 bg-black/30 p-4 space-y-3">
          <div class="flex items-center gap-2 text-sm font-semibold text-white/70">
            <i data-lucide="share-2" class="w-4 h-4"></i>
            설정 공유 링크
          </div>
          <textarea id="shareLink" class="w-full min-h-[90px] rounded-2xl border border-white/10 bg-black/40 px-4 py-3 text-sm text-white/80 focus:outline-none focus:ring-4 focus:ring-purple-400/20" readonly placeholder="입력값이 있을 때 자동 생성됩니다."></textarea>
          <div class="flex flex-wrap gap-2">
            <button id="btnCopyShare" class="flex items-center gap-2 rounded-xl border border-purple-400/40 bg-purple-400/20 px-3 py-1.5 text-sm text-purple-100 hover:bg-purple-400/30">
              <i data-lucide="share" class="w-4 h-4"></i> 공유 링크 복사
            </button>
            <button id="btnOpenShare" class="flex items-center gap-2 rounded-xl border border-white/20 bg-transparent px-3 py-1.5 text-sm text-white/70 hover:bg-white/10">
              <i data-lucide="external-link" class="w-4 h-4"></i> 새 창에서 열기
            </button>
          </div>
          <p class="text-xs text-white/40">공유 링크는 현재 입력된 값만 포함하며, 민감한 정보는 입력하지 마세요.</p>
        </div>
      </div>

      <div class="overflow-hidden rounded-2xl border border-white/10">
        <div class="bg-white/5 px-4 py-3 text-sm font-semibold text-white/70 flex items-center gap-2">
          <i data-lucide="table" class="w-4 h-4"></i>
          UTM 파라미터 미리보기
        </div>
        <div class="overflow-x-auto bg-black/20">
          <table class="min-w-full text-sm">
            <thead class="bg-white/5 text-white/60 uppercase text-xs tracking-wider">
              <tr>
                <th class="px-4 py-2 text-left">Parameter</th>
                <th class="px-4 py-2 text-left">Value</th>
                <th class="px-4 py-2 text-left">설명</th>
              </tr>
            </thead>
            <tbody id="paramTable" class="divide-y divide-white/10">
              <tr id="paramEmpty" class="text-white/40">
                <td class="px-4 py-3" colspan="3">입력된 UTM 파라미터가 없습니다.</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <section class="grid gap-6 lg:grid-cols-2">
      <article class="panel rounded-3xl border border-white/10 ring-soft p-6 space-y-4">
        <header class="flex items-center gap-2 text-lg font-semibold text-white">
          <i data-lucide="lightbulb" class="w-5 h-5 text-amber-300"></i>
          사용 — 도움말 &amp; 팁
        </header>
        <ul class="space-y-3 text-sm text-white/70 leading-relaxed">
          <li class="flex gap-3"><span class="mt-1 inline-flex h-6 w-6 flex-none items-center justify-center rounded-full bg-amber-300/15 text-amber-200">1</span><span>모든 값은 소문자와 하이픈(-) 중심의 네이밍 규칙을 권장합니다. 공백 대신 하이픈을 사용하면 분석 리포트 정렬이 쉬워집니다.</span></li>
          <li class="flex gap-3"><span class="mt-1 inline-flex h-6 w-6 flex-none items-center justify-center rounded-full bg-amber-300/15 text-amber-200">2</span><span>utm_medium은 <span class="font-mono">cpc</span>, <span class="font-mono">email</span>, <span class="font-mono">social</span>처럼 채널 유형을 명시하고, utm_source는 매체 이름을 입력하세요.</span></li>
          <li class="flex gap-3"><span class="mt-1 inline-flex h-6 w-6 flex-none items-center justify-center rounded-full bg-amber-300/15 text-amber-200">3</span><span>기존 URL에 이미 쿼리 파라미터가 있어도 걱정하지 마세요. 이 도구는 기존 값을 보존하면서 UTM만 추가합니다.</span></li>
          <li class="flex gap-3"><span class="mt-1 inline-flex h-6 w-6 flex-none items-center justify-center rounded-full bg-amber-300/15 text-amber-200">4</span><span>광고 플랫폼별 템플릿 버튼을 눌러 빠르게 기본값을 불러오고, 필요한 부분만 수정하세요.</span></li>
        </ul>
      </article>
      <article class="panel rounded-3xl border border-white/10 ring-soft p-6 space-y-4">
        <header class="flex items-center gap-2 text-lg font-semibold text-white">
          <i data-lucide="book-open" class="w-5 h-5 text-sky-300"></i>
          사용설명서 &amp; FAQ
        </header>
        <dl class="space-y-4 text-sm text-white/70 leading-relaxed">
          <div>
            <dt class="font-semibold text-white">① URL 필드에 붙여넣기</dt>
            <dd class="mt-1 text-white/60">프로토콜(https://)이 없으면 자동 보정 버튼이 나타납니다. 클릭하면 https가 앞에 붙습니다.</dd>
          </div>
          <div>
            <dt class="font-semibold text-white">② 필수 UTM 입력</dt>
            <dd class="mt-1 text-white/60">utm_source, utm_medium, utm_campaign 세 가지는 반드시 채워야 성과 분석이 가능합니다.</dd>
          </div>
          <div>
            <dt class="font-semibold text-white">③ 커스텀 파라미터 관리</dt>
            <dd class="mt-1 text-white/60">추가 버튼을 누르면 사용자 정의 키/값을 등록할 수 있습니다. 비워두면 자동으로 제거됩니다.</dd>
          </div>
          <div>
            <dt class="font-semibold text-white">④ 공유 &amp; 협업</dt>
            <dd class="mt-1 text-white/60">공유 링크를 복사해 팀에게 전달하면 동일한 설정을 바로 불러올 수 있습니다.</dd>
          </div>
          <div>
            <dt class="font-semibold text-white">⑤ 데이터 보안</dt>
            <dd class="mt-1 text-white/60">모든 계산은 브라우저에서 이루어지며 서버에 저장되지 않습니다.</dd>
          </div>
        </dl>
      </article>
    </section>
  </main>

  <div data-include="/partials/footer.html"></div>

  <script defer src="/inject-layout.js?v=7"></script>
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const icons = () => window.lucide?.createIcons?.();
    icons();

    const baseUrl = document.getElementById('baseUrl');
    const urlStatus = document.getElementById('urlStatus');
    const btnNormalize = document.getElementById('btnNormalize');
    const inputs = {
      utm_source: document.getElementById('utmSource'),
      utm_medium: document.getElementById('utmMedium'),
      utm_campaign: document.getElementById('utmCampaign'),
      utm_term: document.getElementById('utmTerm'),
      utm_content: document.getElementById('utmContent'),
      utm_id: document.getElementById('utmId')
    };
    const finalUrl = document.getElementById('finalUrl');
    const shareLink = document.getElementById('shareLink');
    const paramTable = document.getElementById('paramTable');
    const paramEmpty = document.getElementById('paramEmpty');
    const paramCount = document.getElementById('paramCount');
    const copyToast = document.getElementById('copyToast');
    const customList = document.getElementById('customList');

    const btnCopyUrl = document.getElementById('btnCopyUrl');
    const btnCopyQuery = document.getElementById('btnCopyQuery');
    const btnReset = document.getElementById('btnReset');
    const btnCopyShare = document.getElementById('btnCopyShare');
    const btnOpenShare = document.getElementById('btnOpenShare');
    const btnAddCustom = document.getElementById('btnAddCustom');
    const presets = document.querySelectorAll('button.preset');

    const presetDescription = {
      utm_source: '유입 채널 식별용 값',
      utm_medium: '유입 매체 유형 (예: cpc, email)',
      utm_campaign: '캠페인 이름 또는 프로모션 코드',
      utm_term: '검색 키워드 또는 타겟 키워드',
      utm_content: 'A/B 테스트 요소 또는 소재 식별자',
      utm_id: '캠페인 ID, 광고 세트 ID 등 내부 식별자'
    };

    let customId = 0;

    function normalizeUrl(raw) {
      if (!raw.trim()) return { normalized: '', isValid: false, message: 'URL을 입력해주세요.', needsNormalization: false, tone: 'muted' };
      const trimmed = raw.trim();
      try {
        const url = new URL(trimmed);
        return { normalized: url.toString(), isValid: true, message: '유효한 URL입니다.', needsNormalization: false, tone: 'positive' };
      } catch {
        try {
          const url = new URL('https://' + trimmed.replace(/^https?:\/\//,'').trim());
          return { normalized: url.toString(), isValid: true, message: 'https:// 를 자동으로 보정했습니다.', needsNormalization: true, tone: 'info' };
        } catch {
          return { normalized: trimmed, isValid: false, message: 'URL 형식을 확인해주세요. 예: https://example.com', needsNormalization: false, tone: 'negative' };
        }
      }
    }

    function getCustomEntries() {
      return Array.from(customList.querySelectorAll('[data-custom-id]')).map(node => {
        const key = node.querySelector('input[data-role="key"]').value.trim();
        const value = node.querySelector('input[data-role="value"]').value.trim();
        return { key, value };
      }).filter(item => item.key && item.value);
    }

    function renderCustomRow(key = '', value = '') {
      const id = `custom-${++customId}`;
      const wrapper = document.createElement('div');
      wrapper.dataset.customId = id;
      wrapper.className = 'grid gap-3 sm:grid-cols-[minmax(0,1fr)_minmax(0,1fr)_auto] items-center';
      wrapper.innerHTML = `
        <input data-role="key" class="input rounded-2xl border border-black/10 px-4 py-3 text-sm focus:outline-none focus:ring-4 focus:ring-purple-400/20" placeholder="parameter" />
        <input data-role="value" class="input rounded-2xl border border-black/10 px-4 py-3 text-sm focus:outline-none focus:ring-4 focus:ring-purple-400/20" placeholder="value" />
        <button type="button" class="remove flex items-center justify-center gap-1 rounded-xl border border-white/20 bg-transparent px-3 py-2 text-sm text-white/70 hover:bg-white/10">
          <i data-lucide="trash-2" class="w-4 h-4"></i> 삭제
        </button>
      `;
      customList.appendChild(wrapper);
      wrapper.querySelector('input[data-role="key"]').value = key;
      wrapper.querySelector('input[data-role="value"]').value = value;
      icons();
      wrapper.querySelectorAll('input').forEach(el => el.addEventListener('input', update));
      wrapper.querySelector('button.remove').addEventListener('click', () => {
        wrapper.remove();
        update();
      });
    }

    function buildShareLink(baseNormalized) {
      const share = new URL(window.location.origin + window.location.pathname);
      if (baseNormalized) {
        share.searchParams.set('url', baseNormalized);
      } else if (baseUrl.value.trim()) {
        share.searchParams.set('url', baseUrl.value.trim());
      }
      Object.entries(inputs).forEach(([key, el]) => {
        if (el.value.trim()) share.searchParams.set(key.replace('utm_', ''), el.value.trim());
      });
      const customs = getCustomEntries();
      customs.forEach(item => {
        share.searchParams.append('custom', `${item.key}:${item.value}`);
      });
      shareLink.value = (baseNormalized || customs.length || Object.values(inputs).some(el => el.value.trim())) ? share.toString() : '';
    }

    function update() {
      const { normalized, isValid, message, needsNormalization, tone } = normalizeUrl(baseUrl.value);
      urlStatus.textContent = message;
      const toneClass = tone === 'muted' ? 'text-white/60' : tone === 'info' ? 'text-sky-300' : tone === 'positive' ? 'text-emerald-300' : 'text-rose-300';
      urlStatus.className = 'text-sm ' + toneClass;
      btnNormalize.classList.toggle('hidden', !(needsNormalization));

      if (!isValid) {
        finalUrl.value = '';
        shareLink.value = '';
        paramCount.textContent = '0개 파라미터';
        paramEmpty.classList.remove('hidden');
        paramTable.querySelectorAll('tr[data-param-row]').forEach(n => n.remove());
        return;
      }

      const url = new URL(normalized);
      const params = new URLSearchParams(url.search);
      Object.keys(inputs).forEach(key => params.delete(key));

      Object.entries(inputs).forEach(([key, el]) => {
        const value = el.value.trim();
        if (value) params.set(key, value);
      });

      const customs = getCustomEntries();
      customs.forEach(item => {
        params.set(item.key, item.value);
      });

      url.search = params.toString();
      finalUrl.value = url.toString();

      const utmEntries = Array.from(params.entries()).filter(([key]) => key.startsWith('utm_'));
      const extraEntries = Array.from(params.entries()).filter(([key]) => !key.startsWith('utm_'));
      const rows = [...utmEntries, ...extraEntries];

      paramTable.querySelectorAll('tr[data-param-row]').forEach(n => n.remove());
      if (!rows.length) {
        paramEmpty.classList.remove('hidden');
      } else {
        paramEmpty.classList.add('hidden');
        rows.forEach(([key, value]) => {
          const tr = document.createElement('tr');
          tr.dataset.paramRow = '1';
          tr.className = 'text-white/80 hover:bg-white/5 transition';
          const desc = presetDescription[key] || (key.startsWith('utm_') ? '커스텀 UTM 파라미터' : '사용자 정의 파라미터');
          tr.innerHTML = `
            <td class="px-4 py-2 font-mono text-xs md:text-sm text-sky-200">${key}</td>
            <td class="px-4 py-2 font-mono text-xs md:text-sm text-white/90 break-all">${value}</td>
            <td class="px-4 py-2 text-xs text-white/60">${desc}</td>
          `;
          paramTable.appendChild(tr);
        });
      }

      paramCount.textContent = `${rows.length}개 파라미터`;
      buildShareLink(normalized);
    }

    function copy(text) {
      if (!text) return Promise.resolve(false);
      if (navigator.clipboard?.writeText) {
        return navigator.clipboard.writeText(text).then(() => true).catch(() => fallbackCopy(text));
      }
      return Promise.resolve(fallbackCopy(text));
    }

    function fallbackCopy(text) {
      const textarea = document.createElement('textarea');
      textarea.value = text;
      textarea.setAttribute('readonly', '');
      textarea.style.position = 'absolute';
      textarea.style.left = '-9999px';
      document.body.appendChild(textarea);
      textarea.select();
      try {
        document.execCommand('copy');
        return true;
      } catch {
        return false;
      } finally {
        textarea.remove();
      }
    }

    function showToast(message = '복사되었습니다!') {
      copyToast.textContent = message;
      copyToast.classList.remove('hidden');
      clearTimeout(showToast._timer);
      showToast._timer = setTimeout(() => copyToast.classList.add('hidden'), 2000);
    }

    function resetAll() {
      baseUrl.value = '';
      Object.values(inputs).forEach(el => el.value = '');
      customList.innerHTML = '';
      shareLink.value = '';
      finalUrl.value = '';
      urlStatus.textContent = 'URL을 입력해주세요.';
      urlStatus.className = 'text-sm text-white/60';
      btnNormalize.classList.add('hidden');
      paramCount.textContent = '0개 파라미터';
      paramTable.querySelectorAll('tr[data-param-row]').forEach(n => n.remove());
      paramEmpty.classList.remove('hidden');
      copyToast.classList.add('hidden');
    }

    baseUrl.addEventListener('input', update);
    Object.values(inputs).forEach(el => el.addEventListener('input', update));
    btnNormalize.addEventListener('click', () => {
      const { normalized, isValid } = normalizeUrl(baseUrl.value);
      if (isValid) {
        baseUrl.value = normalized;
        update();
      }
    });

    btnCopyUrl.addEventListener('click', () => {
      copy(finalUrl.value).then(ok => { if (ok) showToast('캠페인 URL을 복사했습니다.'); });
    });

    btnCopyQuery.addEventListener('click', () => {
      if (!finalUrl.value) return;
      const query = finalUrl.value.includes('?') ? finalUrl.value.split('?')[1] : '';
      copy(query).then(ok => { if (ok) showToast('쿼리 문자열을 복사했습니다.'); });
    });

    btnCopyShare.addEventListener('click', () => {
      copy(shareLink.value).then(ok => { if (ok) showToast('공유 링크를 복사했습니다.'); });
    });

    btnOpenShare.addEventListener('click', () => {
      if (shareLink.value) window.open(shareLink.value, '_blank', 'noopener');
    });

    btnReset.addEventListener('click', () => {
      resetAll();
    });

    btnAddCustom.addEventListener('click', () => {
      renderCustomRow();
      update();
    });

    presets.forEach(btn => {
      btn.classList.add('px-2','py-1','rounded-full','border','border-white/15','hover:bg-white/10');
      btn.addEventListener('click', () => {
        try {
          const data = JSON.parse(btn.dataset.preset || '{}');
          Object.entries(data).forEach(([key, value]) => {
            if (inputs[key]) inputs[key].value = value;
          });
          update();
        } catch (e) {
          console.warn('preset 파싱 실패', e);
        }
      });
    });

    function hydrateFromQuery() {
      const params = new URLSearchParams(location.search);
      if (params.has('url')) baseUrl.value = params.get('url') || '';
      Object.entries(inputs).forEach(([key, el]) => {
        const simpleKey = key.replace('utm_', '');
        if (params.has(simpleKey)) {
          el.value = params.get(simpleKey) || '';
        }
      });
      params.getAll('custom').forEach(item => {
        const [key, ...rest] = item.split(':');
        const value = rest.join(':');
        if (key && value) renderCustomRow(key, value);
      });
    }

    hydrateFromQuery();
    update();

    window.addEventListener('keydown', (e) => {
      if ((e.metaKey || e.ctrlKey) && e.key.toLowerCase() === 'k') {
        e.preventDefault();
        baseUrl.focus();
      }
    });
  });
  </script>

  <noscript><div style="max-width:48rem;margin:2rem auto;padding:1rem;border:1px solid #e5e7eb33;border-radius:.75rem;color:#e5e7eb">이 도구는 자바스크립트를 필요로 합니다. 브라우저 설정에서 JavaScript를 허용해주세요.</div></noscript>
</body>
</html>
